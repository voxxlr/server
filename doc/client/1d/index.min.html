<!DOCTYPE html>
<html>
<head>
    
    <link rel="shortcut icon" href="data:image/x-icon;," type="image/x-icon"> 
    <title>Voxxlr</title>
    <link rel="canonical" href="https://www.voxxlr.com/index.html">
    <meta charset="utf-8" >


    <script>
        
        window.addEventListener("load", function() 
        {
            document.addEventListener('contextmenu', event => event.preventDefault());
            
            var config = {{#content}}{{{.}}}{{/content}}   {{^content}}null{{/content}};
            
            var viewer = new V1.Viewer(config);
            if (config != null)
            {       	
                viewer.load(config.id, new M.Image(config, V.viewerCb));
            }
       });
    
    </script>
        
    
    <style>
    
        body { overflow: hidden;  touch-action: none; }
        canvas { position: absolute; top: 0px; left: 0px; width:100%; height:100% }
        
    </style>

</head>


<body>

    <canvas id="canvas3D"></canvas>
    <canvas id="canvas2D" class="events"></canvas> 
   
</body>


<script id="/geom/geom.js">GM={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,clamp:function(a,b,c){return Math.max(b,Math.min(c,a))}};
GM.Vector3=class{constructor(a,b,c){this.x=a||0;this.y=b||0;this.z=c||0}clone(){return new GM.Vector3(this.x,this.y,this.z)}copy(a){this.x=a.x;this.y=a.y;this.z=a.z;return this}set(a,b,c){this.x=a;this.y=b;this.z=c;return this}readArray(a,b){this.x=a[b];this.y=a[b+1];this.z=a[b+2];return this}add(a){this.x+=a.x;this.y+=a.y;this.z+=a.z;return this}sub(a){this.x-=a.x;this.y-=a.y;this.z-=a.z;return this}multiply(a){this.x*=a.x;this.y*=a.y;this.z*=a.z;return this}addScaledVector(a,b){this.x+=a.x*b;this.y+=
a.y*b;this.z+=a.z*b;return this}crossVectors(a,b){var c=a.x,d=a.y;a=a.z;var e=b.x,f=b.y;b=b.z;this.x=d*b-a*f;this.y=a*e-c*b;this.z=c*f-d*e;return this}subVectors(a,b){this.x=a.x-b.x;this.y=a.y-b.y;this.z=a.z-b.z;return this}multiplyScalar(a){isFinite(a)?(this.x*=a,this.y*=a,this.z*=a):this.z=this.y=this.x=0;return this}multiplyVectors(a,b){this.x=a.x*b.x;this.y=a.y*b.y;this.z=a.z*b.z;return this}applyMatrix3(a){var b=this.x,c=this.y,d=this.z;a=a.elements;this.x=a[0]*b+a[3]*c+a[6]*d;this.y=a[1]*b+
a[4]*c+a[7]*d;this.z=a[2]*b+a[5]*c+a[8]*d;return this}transform(a){var b=this.x,c=this.y,d=this.z;a=a.elements;this.x=a[0]*b+a[4]*c+a[8]*d+a[12];this.y=a[1]*b+a[5]*c+a[9]*d+a[13];this.z=a[2]*b+a[6]*c+a[10]*d+a[14];return this}applyQuaternion(a){var b=this.x,c=this.y,d=this.z,e=a.x,f=a.y,g=a.z;a=a.w;var h=a*b+f*d-g*c,k=a*c+g*b-e*d,l=a*d+e*c-f*b;b=-e*b-f*c-g*d;this.x=h*a+b*-e+k*-g-l*-f;this.y=k*a+b*-f+l*-e-h*-g;this.z=l*a+b*-g+h*-f-k*-e;return this}divide(a){this.x/=a.x;this.y/=a.y;this.z/=a.z;return this}divideScalar(a){return this.multiplyScalar(1/
a)}min(a){this.x=Math.min(this.x,a.x);this.y=Math.min(this.y,a.y);this.z=Math.min(this.z,a.z);return this}max(a){this.x=Math.max(this.x,a.x);this.y=Math.max(this.y,a.y);this.z=Math.max(this.z,a.z);return this}negate(){this.x=-this.x;this.y=-this.y;this.z=-this.z;return this}dot(a){return this.x*a.x+this.y*a.y+this.z*a.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}normalize(){return this.divideScalar(this.length())}distanceTo(a){return Math.sqrt(this.distanceToSquared(a))}distanceToSquared(a){var b=
this.x-a.x,c=this.y-a.y;a=this.z-a.z;return b*b+c*c+a*a}setFromMatrixColumn(a,b){return this.readArray(a.elements,4*b)}toJson(){return{x:this.x,y:this.y,z:this.z}}static create(a,b,c){return{x:a,y:b,z:c}}static mag(a){return Math.sqrt(a.x*a.x+a.y*a.y+a.z*a.z)}static normalize(a,b){var c=GM.Vector3.mag(a);b.x=a.x/c;b.y=a.y/c;b.z=a.z/c;return b}static negate(a,b){b.x=-a.x;b.y=-a.y;b.z=-a.z}static cross(a,b,c){var d=a.x,e=a.y;a=a.z;var f=b.x,g=b.y;b=b.z;c.x=e*b-a*g;c.y=a*f-d*b;c.z=d*g-e*f;return c}static distance(a,
b){var c=a.x-b.x,d=a.y-b.y;a=a.z-b.z;return Math.sqrt(c*c+d*d+a*a)}static dot(a,b){return a.x*b.x+a.y*b.y+a.z*b.z}static rotate(a,b,c){var d=a.x,e=a.y;a=a.z;c.x=b[0]*d+b[4]*e+b[8]*a;c.y=b[1]*d+b[5]*e+b[9]*a;c.z=b[2]*d+b[6]*e+b[10]*a;return c}static addScalar(a,b,c,d){d.x=a.x+b.x*c;d.y=a.y+b.y*c;d.z=a.z+b.z*c;return d}static copy(a,b){b.x=a.x;b.y=a.y;b.z=a.z;return b}static scale(a,b,c){c.x=a.x*b;c.y=a.y*b;c.z=a.z*b;return c}static transform(a,b,c){let d=a.x;var e=a.y;a=a.z;c.x=b[0]*d+b[4]*e+b[8]*
a+b[12];c.y=b[1]*d+b[5]*e+b[9]*a+b[13];c.z=b[2]*d+b[6]*e+b[10]*a+b[14];return c}static subtract(a,b,c){c.x=a.x-b.x;c.y=a.y-b.y;c.z=a.z-b.z;return c}static min(a,b,c){c.x=Math.min(a.x,b.x);c.y=Math.min(a.y,b.y);c.z=Math.min(a.z,b.z);return c}static max(a,b,c){c.x=Math.max(a.x,b.x);c.y=Math.max(a.y,b.y);c.z=Math.max(a.z,b.z);return c}static add(a,b,c){c.x=a.x+b.x;c.y=a.y+b.y;c.z=a.z+b.z;return c}static sub(a,b,c){c=c||{};c.x=a.x-b.x;c.y=a.y-b.y;c.z=a.z-b.z;return c}static sub3V(a,b,c,d,e){e=e||{};e.x=
a-d.x;e.y=b-d.y;e.z=c-d.z;return e}static read(a,b,c){a.x=b[c];a.y=b[c+1];a.z=b[c+2];return a}static fromMatrix(a,b){b.x=a[12];b.y=a[13];b.z=a[14]}};
GM.Ray=class{constructor(a,b){this.origin=void 0!==a?a:new GM.Vector3;this.direction=void 0!==b?b:new GM.Vector3}set(a,b){this.origin.copy(a);this.direction.copy(b);return this}copy(a){this.origin.copy(a.origin);this.direction.copy(a.direction)}transform(a){this.direction.x+=this.origin.x;this.direction.y+=this.origin.y;this.direction.z+=this.origin.z;this.direction.transform(a);this.origin.transform(a);this.direction.x-=this.origin.x;this.direction.y-=this.origin.y;this.direction.z-=this.origin.z;
return this}at(a,b){b.x=this.origin.x+this.direction.x*a;b.y=this.origin.y+this.direction.y*a;b.z=this.origin.z+this.direction.z*a;return b}intersectBox(a){var b=[0,0,0];var c=1/this.direction.x;var d=1/this.direction.y;var e=1/this.direction.z,f=this.origin;if(0<=c){var g=(a.min.x-f.x)*c;c*=a.max.x-f.x;b[0]=0}else g=(a.max.x-f.x)*c,c*=a.min.x-f.x,b[0]=1;var h=b[0];if(0<=d){var k=(a.min.y-f.y)*d;d*=a.max.y-f.y;b[1]=2}else k=(a.max.y-f.y)*d,d*=a.min.y-f.y,b[1]=3;if(g>d||k>c)return null;if(k>g||g!==
g)g=k,h=b[1];if(d<c||c!==c)c=d;0<=e?(k=(a.min.z-f.z)*e,a=(a.max.z-f.z)*e,b[2]=4):(k=(a.max.z-f.z)*e,a=(a.min.z-f.z)*e,b[2]=5);if(g>a||k>c)return null;if(k>g||g!==g)g=k,h=b[2];if(a<c||c!==c)c=a;return 0>c?null:{distance:g,face:h}}intersectMinMax(a,b){var c=1/this.direction.x;var d=1/this.direction.y;var e=1/this.direction.z,f=this.origin;if(0<=c){var g=(a[0]-f.x)*c;c*=b[0]-f.x}else g=(b[0]-f.x)*c,c*=a[0]-f.x;if(0<=d){var h=(a[1]-f.y)*d;d*=b[1]-f.y}else h=(b[1]-f.y)*d,d*=a[1]-f.y;if(g>d||h>c)return null;
if(h>g||g!==g)g=h;if(d<c||c!==c)c=d;0<=e?(h=(a[2]-f.z)*e,a=(b[2]-f.z)*e):(h=(b[2]-f.z)*e,a=(a[2]-f.z)*e);if(g>a||h>c)return null;if(h>g||g!==g)g=h;if(a<c||c!==c)c=a;return 0>c?null:g}intersectPlane(a,b){a=-(GM.Vector3.dot(a,this.origin)-a.w)/GM.Vector3.dot(a,this.direction);return 0<=a?this.at(a,b):null}static transform(a,b,c){GM.Vector3.add(a.direction,a.origin,c.direction);GM.Vector3.transform(c.direction,b,c.direction);GM.Vector3.transform(a.origin,b,c.origin);GM.Vector3.sub(c.direction,c.origin,
c.direction);return c}static intersectPlane(a,b,c){b=-(b.x*a.origin.x+b.y*a.origin.y+b.z*a.origin.z-b.w)/(b.x*a.direction.x+b.y*a.direction.y+b.z*a.direction.z);c.x=a.direction.x*b+a.origin.x;c.y=a.direction.y*b+a.origin.y;c.z=a.direction.z*b+a.origin.z;return c}};
GM.Plane=class{static create(a,b,c,d){return{x:a,y:b,z:c,w:d}}static init(a,b,c,d,e){a.x=b;a.y=c;a.z=d;a.w=e;return a}static fromNormalPoint(a,b,c){GM.Vector3.copy(a,c);c.w=GM.Vector3.dot(b,a)}static copy(a,b){GM.Vector3.copy(a,b);b.w=a.w}static normalize(a,b){var c=1/GM.Vector3.mag(a);GM.Vector3.scale(a,c,b);b.w=a.w*c}static transform(a,b,c){let d=a.x;var e=a.y;let f=a.z;a=a.w;c.x=b[0]*d+b[4]*e+b[8]*f+b[12]*a;c.y=b[1]*d+b[5]*e+b[9]*f+b[13]*a;c.z=b[2]*d+b[6]*e+b[10]*f+b[14]*a;c.w=b[3]*d+b[7]*e+b[11]*
f+b[15]*a;return c}};
GM.Quaternion=class{constructor(a,b,c,d){this.x=a||0;this.y=b||0;this.z=c||0;this.w=void 0!==d?d:1}fromEuler(a){var b=Math.cos(a.x/2),c=Math.cos(a.y/2),d=Math.cos(a.z/2),e=Math.sin(a.x/2),f=Math.sin(a.y/2);a=Math.sin(a.z/2);this.x=e*c*d+b*f*a;this.y=b*f*d-e*c*a;this.z=b*c*a-e*f*d;this.w=b*c*d+e*f*a}fromAxisAngle(a,b){b/=2;var c=Math.sin(b);this.x=a.x*c;this.y=a.y*c;this.z=a.z*c;this.w=Math.cos(b)}slerp(a,b){var c=this.x,d=this.y,e=this.z,f=this.w,g=f*a.w+c*a.x+d*a.y+e*a.z;0>g?(this.w=-a.w,this.x=
-a.x,this.y=-a.y,this.z=-a.z,g=-g):(this.w=a.w,this.x=a.x,this.y=a.y,this.z=a.z);if(1<=g)return this.w=f,this.x=c,this.y=d,this.z=e,this;a=Math.sqrt(1-g*g);if(.001>Math.abs(a))return this.w=.5*(f+this.w),this.x=.5*(c+this.x),this.y=.5*(d+this.y),this.z=.5*(e+this.z),this;var h=Math.atan2(a,g);g=Math.sin((1-b)*h)/a;b=Math.sin(b*h)/a;this.w=f*g+this.w*b;this.x=c*g+this.x*b;this.y=d*g+this.y*b;this.z=e*g+this.z*b;return this}static multiply(a,b,c){const d=a.x,e=a.y,f=a.z;a=a.w;const g=b.x,h=b.y,k=b.z;
b=b.w;c.x=d*b+a*g+e*k-f*h;c.y=e*b+a*h+f*g-d*k;c.z=f*b+a*k+d*h-e*g;c.w=a*b-d*g-e*h-f*k;return c}static between(a,b,c){let d=GM.Vector3.dot(a,b)+1;d<Number.EPSILON?(Math.abs(a.x)>Math.abs(a.z)?(c.x=-a.y,c.y=a.x,c.z=0):(c.x=0,c.y=-a.z,c.z=a.y),c.w=0):(c.x=a.y*b.z-a.z*b.y,c.y=a.z*b.x-a.x*b.z,c.z=a.x*b.y-a.y*b.x,c.w=d);a=Math.sqrt(c.x*c.x+c.y*c.y+c.z*c.z+c.w*c.w);a>Number.EPSILON?(c.x/=a,c.y/=a,c.z/=a,c.w/=a):(c.x=0,c.y=0,c.z=0,c.w=1);return c}static axisAngle(a,b,c,d,e){d/=2;let f=Math.sin(d);e.x=a*f;
e.y=b*f;e.z=c*f;e.w=Math.cos(d);return e}static slerp(a,b,c,d){c.x=a.x;c.y=a.y;c.z=a.z;c.w=a.w;c.slerp(b,d)}static create(a,b,c,d){return{x:a,y:b,z:c,w:d}}};GM.Matrix3=function(){this.elements=new Float32Array([1,0,0,0,1,0,0,0,1])};GM.Matrix3.prototype.clone=function(){var a=new GM.Matrix3;a.elements.set(this.elements);return a};
GM.Matrix4=class{static create(){return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}static init(a){return new Float32Array(a)}static transpose(a,b){for(var c=0;4>c;c++)for(var d=0;4>d;d++)b[4*c+d]=a[c+4*d];return b}static invert(a,b){let c=a[0],d=a[1],e=a[2],f=a[3],g=a[4],h=a[5],k=a[6],l=a[7],m=a[8],n=a[9],q=a[10],p=a[11],r=a[12],t=a[13],u=a[14];a=a[15];let w=n*u*l-t*q*l+t*k*p-h*u*p-n*k*a+h*q*a,x=r*q*l-m*u*l-r*k*p+g*u*p+m*k*a-g*q*a,y=m*t*l-r*n*l+r*h*p-g*t*p-m*h*a+g*n*a,z=r*n*k-m*t*k-r*h*q+
g*t*q+m*h*u-g*n*u,v=1/(c*w+d*x+e*y+f*z);b[0]=w*v;b[1]=(t*q*f-n*u*f-t*e*p+d*u*p+n*e*a-d*q*a)*v;b[2]=(h*u*f-t*k*f+t*e*l-d*u*l-h*e*a+d*k*a)*v;b[3]=(n*k*f-h*q*f-n*e*l+d*q*l+h*e*p-d*k*p)*v;b[4]=x*v;b[5]=(m*u*f-r*q*f+r*e*p-c*u*p-m*e*a+c*q*a)*v;b[6]=(r*k*f-g*u*f-r*e*l+c*u*l+g*e*a-c*k*a)*v;b[7]=(g*q*f-m*k*f+m*e*l-c*q*l-g*e*p+c*k*p)*v;b[8]=y*v;b[9]=(r*n*f-m*t*f-r*d*p+c*t*p+m*d*a-c*n*a)*v;b[10]=(g*t*f-r*h*f+r*d*l-c*t*l-g*d*a+c*h*a)*v;b[11]=(m*h*f-g*n*f-m*d*l+c*n*l+g*d*p-c*h*p)*v;b[12]=z*v;b[13]=(m*t*e-r*n*
e+r*d*q-c*t*q-m*d*u+c*n*u)*v;b[14]=(r*h*e-g*t*e-r*d*k+c*t*k+g*d*u-c*h*u)*v;b[15]=(g*n*e-m*h*e+m*d*k-c*n*k-g*d*q+c*h*q)*v;return b}static quaternion(a,b){var c=a.x,d=a.y,e=a.z,f=a.w,g=c+c,h=d+d;let k=e+e;a=c*g;let l=c*h;c*=k;let m=d*h;d*=k;e*=k;g*=f;h*=f;f*=k;b[0]=1-(m+e);b[4]=l-f;b[8]=c+h;b[1]=l+f;b[5]=1-(a+e);b[9]=d-g;b[2]=c-h;b[6]=d+g;b[10]=1-(a+m);b[3]=0;b[7]=0;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b}static fromEuler(a,b){var c=Math.cos(a.x),d=Math.sin(a.x),e=Math.cos(a.y),f=Math.sin(a.y),
g=Math.cos(a.z);a=Math.sin(a.z);var h=e*g,k=e*a,l=f*g,m=f*a;b[0]=h+m*d;b[4]=l*d-k;b[8]=c*f;b[1]=c*a;b[5]=c*g;b[9]=-d;b[2]=k*d-l;b[6]=m+h*d;b[10]=c*e;return b}static position(a,b){b[12]=a.x;b[13]=a.y;b[14]=a.z;return b}static copy(a,b){b.set(a);return a}static multiply(a,b,c){var d=a[0],e=a[4],f=a[8],g=a[12],h=a[1],k=a[5],l=a[9],m=a[13],n=a[2],q=a[6],p=a[10],r=a[14],t=a[3],u=a[7],w=a[11];a=a[15];var x=b[0],y=b[4],z=b[8],v=b[12],A=b[1],B=b[5],C=b[9],D=b[13],E=b[2],F=b[6],G=b[10],H=b[14],I=b[3],J=b[7],
K=b[11];b=b[15];c[0]=d*x+e*A+f*E+g*I;c[4]=d*y+e*B+f*F+g*J;c[8]=d*z+e*C+f*G+g*K;c[12]=d*v+e*D+f*H+g*b;c[1]=h*x+k*A+l*E+m*I;c[5]=h*y+k*B+l*F+m*J;c[9]=h*z+k*C+l*G+m*K;c[13]=h*v+k*D+l*H+m*b;c[2]=n*x+q*A+p*E+r*I;c[6]=n*y+q*B+p*F+r*J;c[10]=n*z+q*C+p*G+r*K;c[14]=n*v+q*D+p*H+r*b;c[3]=t*x+u*A+w*E+a*I;c[7]=t*y+u*B+w*F+a*J;c[11]=t*z+u*C+w*G+a*K;c[15]=t*v+u*D+w*H+a*b;return c}static yAxisT(a,b){b.x=a[4];b.y=a[5];b.z=a[6];return b}static yAxis(a,b){b.x=a[1];b.y=a[5];b.z=a[9];return b}};
GM.Euler=class{constructor(a,b,c){this.x=a||0;this.y=b||0;this.z=c||0}fromQuaternion(a){var b=a.x+a.x,c=a.y+a.y,d=a.z+a.z,e=a.x*b,f=a.x*c,g=a.x*d,h=a.y*c,k=a.y*d,l=a.z*d;b*=a.w;c*=a.w;a=a.w*d;this.x=Math.asin(-GM.clamp(k-b,-1,1));.99999>Math.abs(k-b)?(this.y=Math.atan2(g+c,1-(e+h)),this.z=Math.atan2(f+a,1-(e+l))):(this.y=Math.atan2(c-g,1-(h+l)),this.z=0)}toJson(){return{x:this.x,y:this.y,z:this.z}}static create(a,b,c){return{x:a,y:b,z:c}}static fromMatrix(a,b){var c=a[0],d=a[8],e=a[1],f=a[5],g=a[9],
h=a[2];a=a[10];b.x=Math.asin(-GM.clamp(g,-1,1));.99999>Math.abs(g)?(b.y=Math.atan2(d,a),b.z=Math.atan2(e,f)):(b.y=Math.atan2(-h,c),b.z=0)}static convert(a,b,c){var d=Math.cos(a.x),e=Math.sin(a.x),f=Math.cos(a.y),g=Math.sin(a.y),h=Math.cos(a.z);a=Math.sin(a.z);let k=GM.Matrix4.create();if("XYZ"===c){c=d*h;var l=d*a,m=e*h,n=e*a;k[0]=f*h;k[4]=-f*a;k[8]=g;k[1]=l+m*g;k[5]=c-n*g;k[9]=-e*f;k[2]=n-c*g;k[6]=m+l*g;k[10]=d*f}else"YXZ"===c?(c=f*h,l=f*a,m=g*h,n=g*a,k[0]=c+n*e,k[4]=m*e-l,k[8]=d*g,k[1]=d*a,k[5]=
d*h,k[9]=-e,k[2]=l*e-m,k[6]=n+c*e,k[10]=d*f):"ZXY"===c?(c=f*h,l=f*a,m=g*h,n=g*a,k[0]=c-n*e,k[4]=-d*a,k[8]=m+l*e,k[1]=l+m*e,k[5]=d*h,k[9]=n-c*e,k[2]=-d*g,k[6]=e,k[1]=d*f):"ZYX"===c?(c=d*h,l=d*a,m=e*h,n=e*a,k[0]=f*h,k[4]=m*g-l,k[8]=c*g+n,k[1]=f*a,k[5]=n*g+c,k[9]=l*g-m,k[2]=-g,k[6]=e*f,k[10]=d*f):"YZX"===c?(c=d*f,l=d*g,m=e*f,n=e*g,k[0]=f*h,k[4]=n-c*a,k[8]=m*a+l,k[1]=a,k[5]=d*h,k[9]=-e*h,k[2]=-g*h,k[6]=l*a+m,k[10]=c-n*a):"XZY"===c&&(c=d*f,l=d*g,m=e*f,n=e*g,k[0]=f*h,k[4]=-a,k[8]=g*h,k[1]=c*a+n,k[5]=d*
h,k[9]=l*a-m,k[2]=m*a-l,k[6]=e*h,k[10]=n*a+c);GM.Euler.fromMatrix(k,b)}static zAxisT(a,b){var c=Math.cos(a.x),d=Math.sin(a.x),e=Math.cos(a.y);b.x=c*Math.sin(a.y);b.y=-d;b.z=c*e;return b}static fromDirection(a){return{x:-Math.asin(-a.y),y:Math.atan2(-a.x,-a.z),z:0}}static copy(a,b){b.x=a.x;b.y=a.y;b.z=a.z;return b}};
GM.Frustum=class{static create(){return[GM.Plane.create(1,0,0,0),GM.Plane.create(1,0,0,0),GM.Plane.create(1,0,0,0),GM.Plane.create(1,0,0,0),GM.Plane.create(1,0,0,0),GM.Plane.create(1,0,0,0)]}static init(a,b){let c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],k=b[6],l=b[7],m=b[8],n=b[9],q=b[10],p=b[11],r=b[12],t=b[13],u=b[14];b=b[15];GM.Plane.init(a[0],f-c,l-g,p-m,b-r);GM.Plane.init(a[1],f+c,l+g,p+m,b+r);GM.Plane.init(a[2],f+d,l+h,p+n,b+t);GM.Plane.init(a[3],f-d,l-h,p-n,b-t);GM.Plane.init(a[4],f-e,l-k,
p-q,b-u);GM.Plane.init(a[5],f+e,l+k,p+q,b+u);GM.Plane.normalize(a[0],a[0]);GM.Plane.normalize(a[1],a[1]);GM.Plane.normalize(a[2],a[2]);GM.Plane.normalize(a[3],a[3]);GM.Plane.normalize(a[4],a[4]);GM.Plane.normalize(a[5],a[5]);return a}static transform(a,b,c){GM.Matrix4.transpose(b,GM.Frustum.matrix);GM.Matrix4.invert(GM.Frustum.matrix,GM.Frustum.matrix);for(b=0;b<a.length;b++)GM.Plane.transform(a[b],GM.Frustum.matrix,c[b])}static intersectsBox(a,b){for(var c=0;5>c;c++){var d=a[c],e=GM.Vector3.dot(d,
{x:0<d.x?b.min.x:b.max.x,y:0<d.y?b.min.y:b.max.y,z:0<d.z?b.min.z:b.max.z})+d.w;d=GM.Vector3.dot(d,{x:0<d.x?b.max.x:b.min.x,y:0<d.y?b.max.y:b.min.y,z:0<d.z?b.max.z:b.min.z})+d.w;if(0>e&&0>d)return!1}d=a[5];e=GM.Vector3.dot(d,{x:0<d.x?b.min.x:b.max.x,y:0<d.y?b.min.y:b.max.y,z:0<d.z?b.min.z:b.max.z})+d.w;d=GM.Vector3.dot(d,{x:0<d.x?b.max.x:b.min.x,y:0<d.y?b.max.y:b.min.y,z:0<d.z?b.max.z:b.min.z})+d.w;if(0>e&&0>d)return!1;b.nearDistance=Math.max(0,Math.min(e,d));return!0}static farDistance(a,b){for(var c=
Number.POSITIVE_INFINITY,d=0;6>d;d++){var e=a[d];c=Math.min(GM.Vector3.dot(e,{x:0<e.x?b.min.x:b.max.x,y:0<e.y?b.min.y:b.max.y,z:0<e.z?b.min.z:b.max.z})+e.w,c);c=Math.min(GM.Vector3.dot(e,{x:0<e.x?b.max.x:b.min.x,y:0<e.y?b.max.y:b.min.y,z:0<e.z?b.max.z:b.min.z})+e.w,c)}return c}static copy(a,b){for(var c=0;6>c;c++)GM.Plane.copy(a[c],b[c])}};GM.Frustum.matrix=GM.Matrix4.create();
GM.Projection=class{constructor(a){this.matrix=GM.Matrix4.create();this.inverse=GM.Matrix4.create();this.mvpMatrix=GM.Matrix4.create();this.mvpInverse=GM.Matrix4.create();this.type=a;this.farOffset=1;this.nearOffset=0;this.far=1E5;this.near=.1}update(a,b,c){GM.Matrix4.invert(this.matrix,this.inverse);GM.Matrix4.multiply(this.matrix,b,this.mvpMatrix);GM.Matrix4.multiply(a,this.inverse,this.mvpInverse)}setRange(a,b){this.near=a;this.far=b}getNear(){return this.near}getFar(){return this.far}set(a){}toJson(){return{}}};
GM.PerspectiveProjection=class extends GM.Projection{constructor(a){super("Perspective");this.setFov(a)}update(a,b,c){let d=this.near,e=this.far,f=c.width/c.height;this.fovV=this.fovH/f;let g=1/this.fovV,h=this.matrix;h[0]=g/f;h[4]=0;h[8]=0;h[12]=0;h[1]=0;h[5]=g;h[9]=0;h[13]=0;h[2]=0;h[6]=0;h[10]=(e+d)/(d-e);h[14]=2*e*d/(d-e);h[3]=0;h[7]=0;h[11]=-1;h[15]=0;super.update(a,b,c)}setFov(a){this.fovH=Math.tan(GM.DEG2RAD*a*.5)}project(a){var b=a.x,c=a.y;a=a.z;var d=this.mvpMatrix,e=1/(d[3]*b+d[7]*c+d[11]*
a+d[15]);0>e&&(e=-e);var f=new GM.Vector3;f.x=(d[0]*b+d[4]*c+d[8]*a+d[12])*e;f.y=(d[1]*b+d[5]*c+d[9]*a+d[13])*e;f.z=(d[2]*b+d[6]*c+d[10]*a+d[14])*e;return f}unproject(a,b){var c=a.x;a=a.y;var d=this.mvpInverse,e=1/(d[3]*c+d[7]*a+d[11]+d[15]);0>e&&(e=-e);b.x=(d[0]*c+d[4]*a+d[8]+d[12])*e;b.y=(d[1]*c+d[5]*a+d[9]+d[13])*e;b.z=(d[2]*c+d[6]*a+d[10]+d[14])*e;return b}setRange2(a,b){var c=b.min,d=b.max,e=0;a.x<c.x?e=c.x-a.x:a.x>d.x&&(e=a.x-d.x);var f=e*e;e=0;a.y<c.y?e=c.y-a.y:a.y>d.y&&(e=a.y-d.y);f+=e*e;
e=0;a.z<c.z?e=c.z-a.z:a.z>d.z&&(e=a.z-d.z);f+=e*e;a=GL.BoundingBox.diagonal(b);f=Math.max(a/1E3,Math.sqrt(f));this.near=f/2;this.far=f+a}getRay(a,b,c){this.unproject(a,c.direction);c.direction.sub(b.position).normalize();c.origin.copy(b.position);return c}toJson(){var a=super.toJson();a.fovV=this.fovV;a.fovH=this.fovH;return a}};
GM.Camera=class{constructor(a){this.viewport=a;this.position=new GM.Vector3;this.rotation=new GM.Euler;this.xAxis=GM.Vector3.create(1,0,0);this.yAxis=GM.Vector3.create(0,1,0);this.zAxis=GM.Vector3.create(0,0,-1);this.ray=new GM.Ray(new GM.Vector3(0,0,0),new GM.Vector3(0,0,-1));this.toggle=this.moving=!1}set(a){this.toggle=!0}changed(){let a=this.toggle;this.toggle=!1;return a}screenToCamera(a){return{x:a.pageX/this.viewport.width*2-1,y:2*-(a.pageY/this.viewport.height)+1}}};
GM.CameraMVP=class extends GM.Camera{constructor(a,b){super(a);this.projection=b;this.matrix=GM.Matrix4.create();this.inverse=GM.Matrix4.create();this.modelViewMatrix=GM.Matrix4.create();this.frustum=GM.Frustum.create()}set(a){super.set();a.matrix?(GM.Euler.fromMatrix(a.matrix,this.rotation),GM.Vector3.fromMatrix(a.matrix,this.position)):(a.position&&GM.Vector3.copy(a.position,this.position),a.rotation&&(a.rotation.order?GM.Euler.convert(a.rotation,this.rotation,a.rotation.order):GM.Vector3.copy(a.rotation,
this.rotation)));a.K&&(this.projection.fovH=.5*a.K[0]/a.K[2])}updateMatrix(){GM.Matrix4.fromEuler(this.rotation,this.matrix);GM.Matrix4.position(this.position,this.matrix);GM.Vector3.read(this.xAxis,this.matrix,0);GM.Vector3.read(this.yAxis,this.matrix,4);GM.Vector3.read(this.zAxis,this.matrix,8);GM.Matrix4.invert(this.matrix,this.inverse);GM.Matrix4.copy(this.inverse,this.modelViewMatrix);this.projection.update(this.matrix,this.inverse,this.viewport);GM.Frustum.init(this.frustum,this.projection.mvpMatrix)}updateRange(a){this.projection.setRange2(this.position,
a)}screenToCamera(a){return{x:a.pageX/this.viewport.width*2-1,y:2*-(a.pageY/this.viewport.height)+1}}intersectsBox(a){return GM.Frustum.intersectsBox(this.frustum,a)}getNearPlane(){var a=this.position.x*this.zAxis.x+this.position.y*this.zAxis.y+this.position.z*this.zAxis.z,b=this.projection.getNear()+.001*(this.projection.getFar()-this.projection.getNear());return{x:this.zAxis.x,y:this.zAxis.y,z:this.zAxis.z,w:a-b}}project(a){a=this.projection.project(a);a.x=(a.x+1)/2;a.y=1-(a.y+1)/2;return a}getRay(a,
b){b||(b=this.ray);return this.projection.getRay(this.screenToCamera(a),this,b)}getRayToPoint(a,b){GM.Vector3.subtract(b,this.position,a.direction);GM.Vector3.normalize(a.direction,a.direction);GM.Vector3.copy(this.position,a.origin);return a}toJson(){return{projection:this.projection.toJson(),position:this.position.toJson(),rotation:this.rotation.toJson(),xAxis:this.xAxis,yAxis:this.yAxis,zAxis:this.zAxis}}};
GM.OrthographicProjection=class extends GM.Projection{constructor(){super("Orthographic");this.zoom=1}update(a,b,c){var d=this.far-this.near,e=this.near+d*this.nearOffset;d=this.far-d*(1-this.farOffset);var f=1/(d-e),g=1/c.height;let h=this.matrix;h[0]=1/c.width*2;h[4]=0;h[8]=0;h[12]=0;h[1]=0;h[5]=2*g;h[9]=0;h[13]=0;h[2]=0;h[6]=0;h[10]=-2*f;h[14]=-((d+e)*f);h[3]=0;h[7]=0;h[11]=0;h[15]=1;super.update(a,b,c)}setRange2(a,b){}project(a){var b=a.x,c=a.y;a=a.z;var d=this.mvpMatrix,e=new GM.Vector3;e.x=
d[0]*b+d[4]*c+d[8]*a+d[12];e.y=d[1]*b+d[5]*c+d[9]*a+d[13];e.z=d[2]*b+d[6]*c+d[10]*a+d[14];return e}unproject(a,b){var c=a.x;a=a.y;var d=this.mvpInverse;b.x=d[0]*c+d[4]*a+d[8]+d[12];b.y=d[1]*c+d[5]*a+d[9]+d[13];b.z=d[2]*c+d[6]*a+d[10]+d[14];return b}getRay(a,b){b=new GM.Vector3(-b.zAxis.x,-b.zAxis.y,-b.zAxis.z);var c=new GM.Vector3;this.unproject(a,c);a=this.getNear();var d=this.getFar();c.x-=b.x*(d-a);c.y-=b.y*(d-a);c.z-=b.z*(d-a);return new GM.Ray(c,b)}};
</script>
<script id="/gl/gl.js">GL={};var gl;GL.Buffer=function(){this.glId=gl.createBuffer()};GL.Buffer.prototype.clear=function(){null!=this.glId&&(gl.deleteBuffer(this.glId),this.glId=null)};
GL.ArrayBuffer=class extends GL.Buffer{constructor(a){super();gl.bindBuffer(gl.ARRAY_BUFFER,this.glId);gl.bufferData(gl.ARRAY_BUFFER,a,gl.STATIC_DRAW);gl.bindBuffer(gl.ARRAY_BUFFER,null);this.length="number"==typeof a?a:a.length}set(a){gl.bindBuffer(gl.ARRAY_BUFFER,this.glId);gl.bufferData(gl.ARRAY_BUFFER,a,gl.STATIC_DRAW);gl.bindBuffer(gl.ARRAY_BUFFER,null);this.length="number"==typeof a?a:a.length}write(a,c){gl.bindBuffer(gl.ARRAY_BUFFER,this.glId);gl.bufferSubData(gl.ARRAY_BUFFER,a,c);gl.bindBuffer(gl.ARRAY_BUFFER,
null)}};GL.ElementBuffer=function(a){GL.Buffer.call(this);gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,this.glId);gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,a,gl.STATIC_DRAW);gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,null);this.length=a.length};GL.ElementBuffer.prototype=Object.create(GL.Buffer.prototype);GL.ElementBuffer.prototype.constructor=GL.ElementBuffer;GL.ImageLoader=function(a,c){this.listener=[];c&&this.listener.push(c);a&&this.load(a)};GL.ImageLoader.prototype.listen=function(a){this.listener.push(a)};
GL.ImageLoader.prototype.load=function(a){function c(b){return 0==(b&b-1)}function d(b){--b;for(var e=1;32>e;e<<=1)b|=b>>e;return b+1}this.image=document.createElementNS("http://www.w3.org/1999/xhtml","img");this.image.onload=function(){URL.revokeObjectURL(this.image.src);if(!c(this.image.width)||!c(this.image.height)){var b=document.createElement("canvas");b.width=d(this.image.width);b.height=d(this.image.height);b.getContext("2d").drawImage(this.image,0,0,b.width,b.height);this.image=b}for(b=0;b<
this.listener.length;b++)this.listener[b].notify(this.image);this.image=null}.bind(this);this.image.crossOrigin="Anonymous";this.image.src=a};
GL.Texture=function(a,c,d){this.name=d;this.glId=gl.createTexture();this.sampler=c;this.sampler||(this.sampler={});gl.bindTexture(gl.TEXTURE_2D,this.glId);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR);gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,1,1,0,gl.RGBA,gl.UNSIGNED_BYTE,new Uint8Array([255,255,255,255]));gl.bindTexture(gl.TEXTURE_2D,null);a instanceof GL.ImageLoader?a.listen(this):a instanceof Image&&this.notify(a)};
GL.Texture.prototype.clear=function(){null!=this.glId&&(gl.deleteTexture(this.glId),this.glId=null)};
GL.Texture.prototype.notify=function(a){gl.bindTexture(gl.TEXTURE_2D,this.glId);this.sampler.minFilter?gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,this.sampler.minFilter):gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.NEAREST_MIPMAP_LINEAR);this.sampler.magFilter?gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,this.sampler.magFilter):gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR);this.sampler.wrapS?gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,this.sampler.wrapS):
gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.REPEAT);this.sampler.wrapT?gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,this.sampler.wrapT):gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.REPEAT);gl.supports_EXT_texture_filter_anisotropic&&gl.texParameterf(gl.TEXTURE_2D,gl.anisotropy,gl.maxAnisotropy);gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,a);gl.generateMipmap(gl.TEXTURE_2D);gl.bindTexture(gl.TEXTURE_2D,null)};
GL.Gradient=function(a){this.name=name;this.glId=gl.createTexture();gl.bindTexture(gl.TEXTURE_2D,this.glId);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR);gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,a.length/4,1,0,gl.RGBA,gl.UNSIGNED_BYTE,new Uint8Array(a));gl.bindTexture(gl.TEXTURE_2D,null)};
GL.Material=function(a){this.name=a.id;this.diffuse=a.diffuse;this.emissive=a.emissive;this.specular=a.specular;this.ambient=a.ambient;this.normal=a.normal;this.transparency=a.transparency};GL.Material.prototype.clear=function(){};
</script>
<script id="/gl/shader.js">GL.Shader=function(a,b){this.defines={};this.uniforms={};this.vertexShader=gl.createShader(gl.VERTEX_SHADER);this.fragmentShader=gl.createShader(gl.FRAGMENT_SHADER);this.glId=gl.createProgram();gl.attachShader(this.glId,this.vertexShader);gl.attachShader(this.glId,this.fragmentShader);this.vertexCode=a;this.fragmentCode=b;this.config=""};GL.Shader.prototype.defineUniforms=function(a){for(var b=0;b<a.length;b++)this.uniforms[a[b]]=gl.getUniformLocation(this.glId,a[b])};
GL.Shader.prototype.enableBuffer=function(a){if(a)for(var b=0;b<this.attributes.length;b++){var c=this.attributes[b];a[c.name]&&gl.enableVertexAttribArray(c.location)}else for(b=0;b<this.attributes.length;b++)c=this.attributes[b],gl.enableVertexAttribArray(c.location)};GL.Shader.prototype.bindBuffer=function(a){for(var b=0;b<this.attributes.length;b++){var c=this.attributes[b];a[c.name]&&(gl.bindBuffer(gl.ARRAY_BUFFER,a[c.name].glId),gl.vertexAttribPointer(c.location,c.size,c.type,c.normalize,0,0))}};
GL.Shader.prototype.disableBuffer=function(a){if(a)for(var b=0;b<this.attributes.length;b++){var c=this.attributes[b];a[c.name]&&gl.disableVertexAttribArray(c.location)}else for(b=0;b<this.attributes.length;b++)c=this.attributes[b],gl.disableVertexAttribArray(c.location)};GL.Shader.prototype.defineAttribute=function(a,b,c,e,d){d=gl.getAttribLocation(this.glId,null==d?a:d);-1!=d?this.attributes.push({location:d,name:a,size:b,type:c,normalize:e}):console.log("attribute "+a+" not found ")};
GL.Shader.prototype.undefineAttribute=function(a){for(var b=0;b<this.attributes.length;b++)if(this.attributes[b].name===a){this.attributes.splice(b,1);break}};GL.Shader.prototype.defineDirective=function(a){this.defines[a]=value};GL.Shader.prototype.undefineDirective=function(a){delete this.defines[a]};
GL.Shader.prototype.compile=function(a){for(var b in this.defines)1==this.defines[b]&&(this.config+="#define "+b+"\n");this.vertexCode.startsWith("#version")?(a=this.vertexCode.indexOf("\n")+1,a=this.vertexCode.slice(0,a)+this.config+this.vertexCode.slice(a)):a=this.config+this.vertexCode;gl.shaderSource(this.vertexShader,a);gl.compileShader(this.vertexShader);!1===gl.getShaderParameter(this.vertexShader,gl.COMPILE_STATUS)&&console.error("Vertex Shader compile error");""!==gl.getShaderInfoLog(this.vertexShader)&&
console.warn(gl.getShaderInfoLog(this.vertexShader));this.fragmentCode.startsWith("#version")?(a=this.fragmentCode.indexOf("\n")+1,a=this.fragmentCode.slice(0,a)+this.config+this.fragmentCode.slice(a)):a=this.config+this.fragmentCode;gl.shaderSource(this.fragmentShader,a);gl.compileShader(this.fragmentShader);!1===gl.getShaderParameter(this.fragmentShader,gl.COMPILE_STATUS)&&console.error("Fragment Shader compile error");""!==gl.getShaderInfoLog(this.fragmentShader)&&console.warn(gl.getShaderInfoLog(this.fragmentShader));
gl.linkProgram(this.glId);this.config="";this.attributes=[]};GL.Shader.prototype.useProgram=function(a){GL.Shader.glId=this.glId;gl.useProgram(this.glId)};GL.Shader.prototype.isActive=function(){return GL.Shader.glId==this.glId};GL.Shader.prototype.clear=function(){gl.deleteProgram(this.glId)};GL.ShaderMVP=function(a,b){GL.Shader.call(this,a,b)};GL.ShaderMVP.prototype=Object.create(GL.Shader.prototype);GL.ShaderMVP.prototype.constructor=GL.ShaderMVP;
GL.ShaderMVP.prototype.useProgram=function(a){GL.Shader.prototype.useProgram.call(this);gl.uniformMatrix4fv(this.modelViewMatrix,!1,a.modelViewMatrix);gl.uniformMatrix4fv(this.projectionMatrix,!1,a.projection.matrix)};GL.ShaderMVP.prototype.updateModelMatrix=function(a){gl.uniformMatrix4fv(this.modelViewMatrix,!1,a.modelViewMatrix)};
GL.ShaderMVP.prototype.compile=function(){GL.Shader.prototype.compile.call(this);this.modelViewMatrix=gl.getUniformLocation(this.glId,"modelViewMatrix");this.projectionMatrix=gl.getUniformLocation(this.glId,"projectionMatrix")};GL.LineShader=function(){GL.ShaderMVP.call(this,GL.LineShader.vs,GL.LineShader.fs)};GL.LineShader.prototype=Object.create(GL.ShaderMVP.prototype);GL.LineShader.prototype.constructor=GL.LineShader;
GL.LineShader.prototype.compile=function(){GL.ShaderMVP.prototype.compile.call(this);this.defineAttribute("position",3,gl.FLOAT,!1);this.defineAttribute("color",3,gl.UNSIGNED_BYTE,!0)};GL.LineShader.vs="\nprecision mediump float;\nprecision mediump int;\n\nuniform mat4 modelViewMatrix; \nuniform mat4 projectionMatrix; \n\nattribute vec3 position;\nattribute vec3 color;\n\nvarying vec3 vColor;\n\nvoid main()\t\n{\n    vColor = color;\n    gl_Position = projectionMatrix * (modelViewMatrix * vec4(position, 1.0));\n}\n";
GL.LineShader.fs="\nprecision mediump float;\nprecision mediump int;\n\nvarying vec3 vColor;\n\nvoid main()\t\n{\n    gl_FragColor = vec4(vColor, 1);\n    //gl_FragColor = vec4(1,1,1, 1);\n}";GL.CopyShader=function(){GL.Shader.call(this,GL.CopyShader.vs,GL.CopyShader.fs)};GL.CopyShader.prototype=Object.create(GL.ShaderMVP.prototype);GL.CopyShader.prototype.constructor=GL.CopyShader;
GL.CopyShader.prototype.compile=function(){GL.ShaderMVP.prototype.compile.call(this);this.defineAttribute("position",3,gl.FLOAT,!1);this.defineAttribute("color",3,gl.UNSIGNED_BYTE,!0)};GL.CopyShader.vs="\nattribute vec3 position;\n\nvoid main()\t\n{\n    gl_Position = position;\n}\n";GL.CopyShader.fs="\nprecision mediump float;\nprecision mediump int;\n\nvarying vec3 vColor;\n\nvoid main()\t\n{\n    gl_FragColor = vec4(vColor, 1);\n    //gl_FragColor = vec4(1,1,1, 1);\n}";
</script>
<script id="/gl/object.js">GL.Axis=function(a,b,c){this.pz=this.py=this.px=0;this.sx=a|1;this.sy=b|1;this.sz=c|1;this.visible=!0;this.color=new GL.ArrayBuffer(new Uint8Array([255,0,0,255,0,0,0,255,0,0,255,0,0,0,255,0,0,255]));this.shader=new GL.LineShader;this.shader.compile();this.update()};GL.Axis.prototype.render=function(a){this.visible&&(this.shader.useProgram(a),this.shader.enableBuffer(this),this.shader.bindBuffer(this),gl.disable(gl.DEPTH_TEST),gl.drawArrays(gl.LINES,0,6),this.shader.disableBuffer(this),gl.enable(gl.DEPTH_TEST))};
GL.Axis.prototype.update=function(){this.position=new GL.ArrayBuffer(new Float32Array([this.px,this.py,this.pz,this.px+this.sx,this.py,this.pz,this.px,this.py,this.pz,this.px,this.py+this.sy,this.pz,this.px,this.py,this.pz,this.px,this.py,this.pz+this.sz]))};GL.Axis.prototype.resize=function(a,b){b=.25*GM.Vector3.mag(GM.Vector3.sub3V(this.px,this.py,this.pz,b.position));this.sx=Math.min(b,a.max.x-a.min.x);this.sy=Math.min(b,a.max.y-a.min.y);this.sz=Math.min(b,a.max.z-a.min.z);this.update()};
GL.Axis.prototype.moveTo=function(a,b,c){this.px=a;this.py=b;this.pz=c;this.update()};
GL.BoundingBox=class{constructor(a){this.position=new GL.ArrayBuffer(new Float32Array([a.min.x,a.min.y,a.min.z,a.max.x,a.min.y,a.min.z,a.max.x,a.min.y,a.min.z,a.max.x,a.max.y,a.min.z,a.max.x,a.max.y,a.min.z,a.min.x,a.max.y,a.min.z,a.min.x,a.max.y,a.min.z,a.min.x,a.min.y,a.min.z,a.min.x,a.min.y,a.max.z,a.max.x,a.min.y,a.max.z,a.max.x,a.min.y,a.max.z,a.max.x,a.max.y,a.max.z,a.max.x,a.max.y,a.max.z,a.min.x,a.max.y,a.max.z,a.min.x,a.max.y,a.max.z,a.min.x,a.min.y,a.max.z,a.min.x,a.min.y,a.min.z,a.min.x,
a.min.y,a.max.z,a.min.x,a.max.y,a.min.z,a.min.x,a.max.y,a.max.z,a.max.x,a.max.y,a.min.z,a.max.x,a.max.y,a.max.z,a.max.x,a.min.y,a.min.z,a.max.x,a.min.y,a.max.z]));this.color=new GL.ArrayBuffer(new Uint8Array([255,0,0,255,0,0,255,0,0,255,0,0,255,0,0,255,0,0,255,0,0,255,0,0,255,0,0,255,0,0,255,0,0,255,0,0,255,0,0,255,0,0,255,0,0,255,0,0,255,0,0,255,0,0,255,0,0,255,0,0,255,0,0,255,0,0,255,0,0,255,0,0]));this.shader=new GL.LineShader;this.shader.compile()}render(a){this.shader.useProgram(a);gl.disable(gl.DEPTH_TEST);
this.shader.enableBuffer(this);this.shader.bindBuffer(this);gl.drawArrays(gl.LINES,0,24);this.shader.disableBuffer(this);gl.enable(gl.DEPTH_TEST)}setColor(a,b,c){this.color=new GL.ArrayBuffer(new Uint8Array([a,b,c,a,b,c,a,b,c,a,b,c,a,b,c,a,b,c,a,b,c,a,b,c,a,b,c,a,b,c,a,b,c,a,b,c,a,b,c,a,b,c,a,b,c,a,b,c,a,b,c,a,b,c,a,b,c,a,b,c,a,b,c,a,b,c,a,b,c,a,b,c]))}update(a){this.position=new GL.ArrayBuffer(new Float32Array([a.min.x,a.min.y,a.min.z,a.max.x,a.min.y,a.min.z,a.max.x,a.min.y,a.min.z,a.max.x,a.max.y,
a.min.z,a.max.x,a.max.y,a.min.z,a.min.x,a.max.y,a.min.z,a.min.x,a.max.y,a.min.z,a.min.x,a.min.y,a.min.z,a.min.x,a.min.y,a.max.z,a.max.x,a.min.y,a.max.z,a.max.x,a.min.y,a.max.z,a.max.x,a.max.y,a.max.z,a.max.x,a.max.y,a.max.z,a.min.x,a.max.y,a.max.z,a.min.x,a.max.y,a.max.z,a.min.x,a.min.y,a.max.z,a.min.x,a.min.y,a.min.z,a.min.x,a.min.y,a.max.z,a.min.x,a.max.y,a.min.z,a.min.x,a.max.y,a.max.z,a.max.x,a.max.y,a.min.z,a.max.x,a.max.y,a.max.z,a.max.x,a.min.y,a.min.z,a.max.x,a.min.y,a.max.z]))}static init(a){a.min=
{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY,z:Number.POSITIVE_INFINITY};a.max={x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY,z:Number.NEGATIVE_INFINITY};return a}static create(a,b){return{min:{x:a.x||a[0],y:a.y||a[1],z:a.z||a[2]},max:{x:b.x||b[0],y:b.y||b[1],z:b.z||b[2]}}}static set(a,b,c){a.min={x:b.x||b[0],y:b.y||b[1],z:b.z||b[2]};a.max={x:c.x||c[0],y:c.y||c[1],z:c.z||c[2]}}static merge(a,b){GM.Vector3.min(a.min,b.min,a.min);GM.Vector3.max(a.max,b.max,a.max)}static grow(a,b){GM.Vector3.min(a.min,
b,a.min);GM.Vector3.max(a.max,b,a.max)}static center(a,b){b=b||{};b.x=(a.min.x+a.max.x)/2;b.y=(a.min.y+a.max.y)/2;b.z=(a.min.z+a.max.z)/2;return b}static diagonal(a){var b=a.max.x-a.min.x,c=a.max.y-a.min.y;a=a.max.z-a.min.z;return Math.sqrt(b*b+c*c+a*a)}static copy(a,b){GM.Vector3.copy(a.min,b.min);GM.Vector3.copy(a.max,b.max);return b}static transform(a,b,c){var d=[b[0]*a.min.x,b[4]*a.min.x,b[8]*a.min.x],e=[b[0]*a.max.x,b[4]*a.max.x,b[8]*a.max.x],f=[b[1]*a.min.y,b[5]*a.min.y,b[9]*a.min.y],g=[b[1]*
a.max.y,b[5]*a.max.y,b[9]*a.max.y],h=[b[2]*a.min.z,b[6]*a.min.z,b[10]*a.min.z];a=[b[2]*a.max.z,b[6]*a.max.z,b[10]*a.max.z];c.min.x=Math.min(d[0],e[0])+Math.min(f[0],g[0])+Math.min(h[0],a[0])+b[12];c.max.x=Math.max(d[0],e[0])+Math.max(f[0],g[0])+Math.max(h[0],a[0])+b[12];c.min.y=Math.min(d[1],e[1])+Math.min(f[1],g[1])+Math.min(h[1],a[1])+b[13];c.max.y=Math.max(d[1],e[1])+Math.max(f[1],g[1])+Math.max(h[1],a[1])+b[13];c.min.z=Math.min(d[2],e[2])+Math.min(f[2],g[2])+Math.min(h[2],a[2])+b[14];c.max.z=
Math.max(d[2],e[2])+Math.max(f[2],g[2])+Math.max(h[2],a[2])+b[14]}};
</script>
<script id="/index.js">U={};
V=function(){var a={viewer:null,touch3d:function(){V.viewer.repaint3d=!0},touch2d:function(){V.viewer.repaint2d=!0},api:{},notify:(b,c)=>{V.EventHandler.APPEVENTS[b].forEach(d=>d.method(c))},startLoading:()=>{a.loading++},stopLoading:()=>{a.loading--},loading:0};a.time=window.performance.now();a.DRAGERROR={r:1,g:.8,b:.8};a.DRAGOK={r:.8,g:1,b:.8};a.NODRAG={r:1,g:1,b:1};a.keyMap=[];a.keyCount=0;document.addEventListener("keydown",b=>{a.keyMap[b.keyCode]||(a.keyCount++,a.keyMap[b.keyCode]=!0)});document.addEventListener("keyup",
b=>{a.keyCount&&(a.keyCount--,a.keyMap[b.keyCode]=!1)});document.addEventListener("mouseout",b=>{a.keyMap=[];a.keyCount=0});a.log=!1;a.postMessage=(b,c,d)=>{V.logging&&console.log(`%c>>>> ${b}\n`,"color:grey; font-weight:800",c);window.parent.postMessage({action:b,args:c,optional:d},"*")};a.recvMessage=(b,c,d)=>{b instanceof Array?b.forEach(e=>a.recvMessage(e,c)):(c.owner=d,V.api[b]?V.api[b].push(c):V.api[b]=[c])};a.unrecvMessage=(b,c)=>{if(b instanceof Array)b.forEach(d=>a.unrecvMessage(d,c));else if(V.api[b]){let d=
V.api[b];for(b=0;b<d.length;b++)d[b].owner==c&&d.splice(b,1)}};a.viewerCb=function(b){let c={},d=RegExp("[?&]custom=([^&#]*)").exec(window.location.href);d&&(c=JSON.parse(decodeURIComponent(d[1])));V.postMessage("viewer.load",b,c)};a.importCb=function(b,c){V.postMessage("import.create",b,this)};a.METRIC=0;a.IMPERIAL=1;a.units=0;a.canvas=document.getElementById("canvas3D");window.addEventListener("message",function(b){if(b.data.action instanceof Array)b.data.action.forEach((e,f)=>{if(e=this.api[e]){this.logging&&
console.log(`%c<<< ${b.data.action}\n`,"color:green; font-weight:800",b.data.args[f]);for(var g=0;g<e.length;g++)e[g](b.data.args[f]||{},b.data.custom||{})}else this.logging&&console.log(`%c<<< ${b.data.action}\n`,"color:red; font-weight:800",b.data.args)});else{var c=this.api[b.data.action];if(c){this.logging&&console.log(`%c<<< ${b.data.action}\n`,"color:green; font-weight:800",b.data.args);for(var d=0;d<c.length;d++)c[d](b.data.args||{},b.data.custom||{})}else this.logging&&console.log(`%c<<< ${b.data.action}\n`,
"color:red; font-weight:800",b.data.args)}}.bind(a));return a}();M={MAX_MEM:367001600,MIN_MEM:325058560,memoryUsed:0,rendered:0};
V.EventHandler=class{constructor(a,b){this.prioSys=a;this.prioApp=b||a;this.cvsListener=[];this.onMouseDown&&this.cvsListener.push({name:"mousedown",method:this.onMouseDown.bind(this),options:{capture:!1}});this.onMouseMove&&this.cvsListener.push({name:"mousemove",method:this.onMouseMove.bind(this),options:{capture:!1}});this.onMouseUp&&this.cvsListener.push({name:"mouseup",method:this.onMouseUp.bind(this),options:{capture:!1}});this.onMouseOut&&this.cvsListener.push({name:"mouseout",method:this.onMouseOut.bind(this),
options:{capture:!1}});this.onMouseWheel&&(this.cvsListener.push({name:"mousewheel",method:this.onMouseWheel.bind(this),options:{capture:!1,passive:!1}}),this.cvsListener.push({name:"DOMMouseScroll",method:this.onMouseWheel.bind(this),options:{capture:!1}}));this.onDblClick&&this.cvsListener.push({name:"dblclick",method:this.onDblClick.bind(this),options:{capture:!1}});this.onClick&&this.cvsListener.push({name:"click",method:this.onClick.bind(this),options:{capture:!1}});this.onTouchStart&&this.cvsListener.push({name:"touchstart",
method:this.onTouchStart.bind(this),options:{capture:!1}});this.onTouchEnd&&this.cvsListener.push({name:"touchend",method:this.onTouchEnd.bind(this),options:{capture:!1}});this.onTouchCancel&&this.cvsListener.push({name:"touchcancel",method:this.onTouchCancel.bind(this),options:{capture:!1}});this.onTouchMove&&this.cvsListener.push({name:"touchmove",method:this.onTouchMove.bind(this),options:{capture:!1}});this.keyListener=[];this.onKeyUp&&this.keyListener.push({name:"keyup",method:this.onKeyUp.bind(this),
options:{capture:!1}});this.onKeyDown&&this.keyListener.push({name:"keydown",method:this.onKeyDown.bind(this),options:{capture:!1}});this.onKeyPressed&&this.keyListener.push({name:"keypress",method:this.onKeyPressed.bind(this),options:{capture:!1}});this.appListener=[];for(var c in V.EventHandler.APPEVENTS)this[c]&&this.appListener.push({name:c,method:this[c].bind(this)})}attach(){V.EventHandler.SYSPRIO.forEach(a=>a.forEach(b=>b.detachSysHandlers()));V.EventHandler.SYSPRIO[this.prioSys].push(this);
V.EventHandler.SYSPRIO.forEach(a=>a.forEach(b=>b.attachSysHandlers()));V.EventHandler.APPPRIO.forEach(a=>a.forEach(b=>b.detachAppHandlers()));V.EventHandler.APPPRIO[this.prioApp].push(this);V.EventHandler.APPPRIO.forEach(a=>a.forEach(b=>b.attachAppHandlers()))}detach(){V.EventHandler.SYSPRIO.forEach(a=>a.forEach(b=>b.detachSysHandlers()));V.EventHandler.SYSPRIO[this.prioSys].splice(V.EventHandler.SYSPRIO[this.prioSys].indexOf(this),1);V.EventHandler.SYSPRIO.forEach(a=>a.forEach(b=>b.attachSysHandlers()));
V.EventHandler.APPPRIO.forEach(a=>a.forEach(b=>b.detachAppHandlers()));V.EventHandler.APPPRIO[this.prioApp].splice(V.EventHandler.APPPRIO[this.prioApp].indexOf(this),1);V.EventHandler.APPPRIO.forEach(a=>a.forEach(b=>b.attachAppHandlers()))}detachSysHandlers(){this.cvsListener.forEach(a=>V.EventHandler.CONTAINER.removeEventListener(a.name,a.method,a.options));this.keyListener.forEach(a=>document.removeEventListener(a.name,a.method,a.options))}attachSysHandlers(){this.cvsListener.forEach(a=>V.EventHandler.CONTAINER.addEventListener(a.name,
a.method,a.options));this.keyListener.forEach(a=>document.addEventListener(a.name,a.method,a.options))}detachAppHandlers(){this.appListener.forEach(a=>V.EventHandler.APPEVENTS[a.name].pop(a))}attachAppHandlers(){this.appListener.forEach(a=>V.EventHandler.APPEVENTS[a.name].push(a))}isAttached(){return V.EventHandler.APPPRIO[this.prioApp].includes(this)}};V.EventHandler.APPPRIO=[[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]];V.EventHandler.SYSPRIO=[[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]];
V.EventHandler.APPEVENTS={onRender2D:[],onRender3D:[],onResize:[],onUpdate:[]};V.EventHandler.PRIO0=0;V.EventHandler.PRIO1=1;V.EventHandler.PRIO2=2;V.EventHandler.PRIO3=3;V.EventHandler.PRIO4=4;V.EventHandler.PRIO5=5;V.EventHandler.PRIO6=6;V.EventHandler.CONTAINER=document.querySelector(".events");
V.Viewer=class{constructor(a){V.viewer=this;this.datasets={};this.aabb=GL.BoundingBox.init({});this.canvas=V.canvas;this.canvas.width=this.canvas.clientWidth;this.canvas.height=this.canvas.clientHeight;this.overlay=new O.Overlay(this);this.overlay.attach();window.addEventListener("resize",()=>{this.canvas.width=this.canvas.clientWidth;this.canvas.height=this.canvas.clientHeight;V.camera.updateMatrix();V.notify("onResize",{width:window.innerWidth,height:window.innerHeight});V.touch2d();V.touch3d()});
gl=this.canvas.getContext("webgl2",a)||this.canvas.getContext("experimental-webgl",a);gl.clearColor(1,1,1,1);gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT);gl.blendFunc(gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA);gl.enable(gl.DEPTH_TEST);gl.enable(gl.CULL_FACE);gl.cullFace(gl.BACK);(a=gl.getExtension("EXT_texture_filter_anisotropic"))?(gl.anisotropy=a.TEXTURE_MAX_ANISOTROPY_EXT,gl.maxAnisotropy=gl.getParameter(a.MAX_TEXTURE_MAX_ANISOTROPY_EXT),gl.supports_EXT_texture_filter_anisotropic=!0):gl.supports_EXT_texture_filter_anisotropic=
!1;GL.GL_EXT_frag_depth=gl.getExtension("EXT_frag_depth");this.animateFn=this.animate.bind(this);this.repaint=this.visible=!0;V.recvMessage("viewer.image.get",b=>{this.imageCallback=b;V.touch3d()});V.recvMessage("import.update",b=>{this.datasets[b.id]&&b.hasOwnProperty("visible")&&(this.datasets[b.id].visible=b.visible,V.touch3d())});V.recvMessage("import.delete",(b,c)=>{if(c=this.datasets[b.id])c.unload(),V.postMessage("import.delete",b),delete this.datasets[b.id],V.touch3d();GL.BoundingBox.init(this.aabb,
{});for(var d in this.datasets)GL.BoundingBox.merge(this.aabb,this.datasets[d])});V.recvMessage("viewer.unload",b=>{for(var c in this.datasets)this.datasets[c].unload(),delete this.datasets[c];GL.BoundingBox.init(this.aabb,{});V.postMessage("viewer.unload",b)});V.recvMessage("repaint",b=>{V.touch2d();V.touch3d()});V.recvMessage("viewpoint",b=>{for(var c in this.datasets){let d=this.datasets[c];b[d.id]&&d.setViewpoint(b[d.id])}V.touch3d();V.postMessage("viewpoint",b)});V.recvMessage("raycast.overlay",
b=>{let c=V.camera.getRay({pageX:b.x,pageY:b.y});b=O.instance.raycast(c,b.x,b.y);V.postMessage("raycast.overlay",b)});V.recvMessage("raycast.content",b=>{let c=V.camera.getRay({pageX:b.x,pageY:b.y});b=V.viewer.raycast(c,{xyz:{},normal:b.normal,distance:Number.POSITIVE_INFINITY});b.distance!=Number.POSITIVE_INFINITY&&b.normal&&GM.Vector3.normalize(b.normal,b.normal);V.postMessage("raycast.content",b)});V.recvMessage("camera.project",b=>{b=V.camera.project(b);V.postMessage("camera.project",{pageX:b.x*
O.canvas.width,pageY:b.y*O.canvas.height})});V.recvMessage("viewer.update",(b,c)=>{b.hasOwnProperty("logging")&&(V.logging=b.logging);b.hasOwnProperty("units")&&(V.units="imperial"===b.units?V.IMPERIAL:V.METRIC);b.hasOwnProperty("clearColor")&&gl.clearColor(b.clearColor[0],b.clearColor[1],b.clearColor[2],1);b.hasOwnProperty("code")&&Function("return "+decodeURI(b.code))().call();V.postMessage("viewer.update",b,c)})}raycast(a,b){for(var c in this.datasets){let e=this.datasets[c];if(e.visible){var d=
a.intersectBox(e);d&&d.distance<b.distance&&(d=b.distance,e.raycast(a,b),b.distance<d&&(b.id=e.id))}}return b}load(a,b){GL.BoundingBox.merge(this.aabb,b);this.datasets[a]=b}startImage(){this.imageCallback.width&&this.imageCallback.height&&(this.imageCallback.oldWidth=this.canvas.width,this.imageCallback.oldHeight=this.canvas.height,V.canvas.width=this.imageCallback.width,V.canvas.height=this.imageCallback.height,V.notify("onResize",{width:V.canvas.width,height:V.canvas.height}),V.touch2d())}endImage(){if(this.imageCallback.oldWidth&&
this.imageCallback.oldHeight){if(this.imageCallback.overlay){var a=document.createElement("canvas");a.width=V.canvas.width;a.height=V.canvas.height;var b=a.getContext("2d");b.drawImage(V.canvas,0,0,a.width,a.height);b.drawImage(O.canvas,0,0,a.width,a.height);V.postMessage("viewer.image.get",a.toDataURL(this.imageCallback.type,this.imageCallback.options))}else V.postMessage("viewer.image.get",V.canvas.toDataURL(this.imageCallback.type,this.imageCallback.options));V.canvas.width=this.imageCallback.oldWidth;
V.canvas.height=this.imageCallback.oldHeight;V.notify("onResize",{width:V.canvas.width,height:V.canvas.height});gl.viewport(0,0,gl.drawingBufferWidth,gl.drawingBufferHeight);gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT);this.render(this.camera);V.notify("onRender3D",this);V.notify("onRender2D",this)}else if(this.imageCallback.maxWidth||this.imageCallback.maxHeight){a=document.createElement("canvas");b=a.getContext("2d");if(this.imageCallback.maxWidth&&this.imageCallback.maxHeight){var c=Math.min(1,
Math.max(this.imageCallback.maxHeight/gl.drawingBufferHeight,this.imageCallback.maxWidth/gl.drawingBufferWidth));a.width=this.imageCallback.maxWidth;a.height=this.imageCallback.maxHeight;let d=Math.floor(.5*(1-c)*gl.drawingBufferWidth),e=Math.floor(.5*(1-c)*gl.drawingBufferHeight);b.drawImage(V.canvas,d,e,gl.drawingBufferWidth*c,gl.drawingBufferHeight*c,0,0,a.width,a.height);this.imageCallback.overlay&&b.drawImage(O.canvas,d,e,gl.drawingBufferWidth*c,gl.drawingBufferHeight*c,0,0,a.width,a.height)}else c=
1,!this.imageCallback.maxHeight&&gl.drawingBufferWidth>this.imageCallback.maxWidth?c=Math.min(c,this.imageCallback.maxWidth/gl.drawingBufferWidth):!this.imageCallback.maxWidth&&gl.drawingBufferHeight>this.imageCallback.maxHeight&&(c=Math.min(c,this.imageCallback.maxHeight/gl.drawingBufferHeight)),a.width=gl.drawingBufferWidth*c,a.height=gl.drawingBufferHeight*c,b.drawImage(V.canvas,0,0,a.width,a.height),this.imageCallback.overlay&&b.drawImage(O.canvas,0,0,a.width,a.height);V.postMessage("viewer.image.get",
a.toDataURL(this.imageCallback.type,this.imageCallback.options))}else this.imageCallback.overlay?(a=document.createElement("canvas"),a.width=V.canvas.width,a.height=V.canvas.height,b=a.getContext("2d"),b.drawImage(V.canvas,0,0,a.width,a.height),b.drawImage(O.canvas,0,0,a.width,a.height),V.postMessage("viewer.image.get",a.toDataURL(this.imageCallback.type,this.imageCallback.options))):V.postMessage("viewer.image.get",V.canvas.toDataURL(this.imageCallback.type,this.imageCallback.options))}animate(){requestAnimationFrame(this.animateFn);
if(this.visible){var a=window.performance.now();V.dT=(a-V.time)/1E3;V.time=a;this.imageCallback&&this.startImage();a=V.camera.moving;V.camera.moving=V.camera.changed();V.notify("onUpdate",{});V.camera.starting=V.camera.moving&&!a;if(V.viewer.repaint3d||V.camera.moving)V.viewer.repaint3d=!1,gl.viewport(0,0,gl.drawingBufferWidth,gl.drawingBufferHeight),gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT),this.render(this.camera),V.notify("onRender3D",this);if(V.viewer.repaint2d||V.camera.moving)V.viewer.repaint2d=
!1,V.notify("onRender2D",this);this.imageCallback&&(this.endImage(),delete this.imageCallback);V.camera.stopping=a&&!V.camera.moving;a&&V.postMessage("camera.update",V.camera.toJson())}}setBufferSize(a,b){V.canvas.width=a;V.canvas.height=b;V.camera.moving=!0}};
V.Dataset=class{constructor(a){this.config=a;this.id=a.id;this.type=a.type;this.root=a.root;this.visible=a.hasOwnProperty("visible")?a.visible:!0;this.lastRefresh=0;this.url=a.source;this.refresh=a.refresh}refreshToken(){!this.promise&&this.refresh&&(this.promise=new Promise((a,b)=>{var c=new XMLHttpRequest;c.open("GET",this.refresh,!0);c.onload=d=>{200==c.status?(d=JSON.parse(d.currentTarget.responseText),this.url=d.source.data,this.refresh=d.source.refresh,a(this.url)):b(c.status)};c.onerror=d=>
{b(c.status)};c.send()}),this.promise.then(()=>{this.promise=null}));return this.promise}};
V.CameraController=class extends V.EventHandler{constructor(a,b,c,d){super(a,b);this.name=name;this.camera=c;this.currPos={x:0,y:0};this.currZoom=0;this.pointerPosition={pageX:0,pageY:0};this.pointerRay=new GM.Ray;this.pointerAge=0;this.cast3d={distance:Number.POSITIVE_INFINITY};this.ray=new GM.Ray;this.q0=new GM.Quaternion;this.qN=new GM.Quaternion;this.qR=new GM.Quaternion;this.min=new GM.Vector3(0,0,0);this.max=new GM.Vector3(0,0,0);this.drag=0;this.dragMax=d;this.shiftKey=!1;this.tn=0;this.keys=
{};this.position={sT:1,p0:{x:0,y:0,z:0},p1:{x:0,y:0,z:0}};this.rotation={sT:1,q0:new GM.Quaternion,q1:new GM.Quaternion,qR:new GM.Quaternion};this.tweenT=this.tweenR=400}tweenPosition(a,b){this.position.p0.x=this.camera.position.x;this.position.p0.y=this.camera.position.y;this.position.p0.z=this.camera.position.z;this.position.p1.x=a.x;this.position.p1.y=a.y;this.position.p1.z=a.z;this.position.t=V.time+(b||this.tweenT);this.position.sT=0}tweenRotation(a,b){this.rotation.q0.fromEuler(this.camera.rotation);
this.rotation.q1.fromEuler(a);this.rotation.t=V.time+(b||this.tweenR);this.rotation.sT=0}tweenStart(a){this.t0=V.time;this.updateFn=a;this.drag=0}tweenStop(){this.position.sT=1;this.position.sT=1;this.updateFn=null;this.drag=0}onUpdate(a){if(1>this.position.sT||1>this.rotation.sT){if(1>this.position.sT){this.position.sT=Math.min(1,(V.time-this.t0)/(this.position.t-this.t0));var b=Easing.Sinusoidal.In(this.position.sT),c=this.position.p0,d=this.position.p1;this.camera.position.x=c.x+(d.x-c.x)*b;this.camera.position.y=
c.y+(d.y-c.y)*b;this.camera.position.z=c.z+(d.z-c.z)*b}1>this.rotation.sT&&(this.rotation.sT=Math.min(1,(V.time-this.t0)/(this.rotation.t-this.t0)),GM.Quaternion.slerp(this.rotation.q0,this.rotation.q1,this.rotation.qR,Easing.Sinusoidal.In(this.rotation.sT)),this.camera.rotation.fromQuaternion(this.rotation.qR));this.camera.moving=!0;this.updateFn&&(this.updateFn.call(this,this,a),1==this.position.sT&&1==this.rotation.sT&&(this.updateFn=null))}else this.updateFn&&(this.updateFn.call(this,this,a),
this.drag&&1==this.drag--&&(this.updateFn=null),this.camera.moving=!0);V.camera.stopping&&(V.camera.getRay(this.pointerPosition,this.pointerRay),V.postMessage("viewer.mousemove",this.castRay3d()))}getWheelDelta(a){var b=a.shiftKey?.2:1;if(void 0!==a.wheelDelta)return-b*a.wheelDelta/4300;if(void 0!==a.detail)return b*a.detail/250}onMouseWheel(a){this.currPos=this.camera.screenToCamera(this.pointerPosition);this.currZoomD=this.getWheelDelta(a);this.currZoom-=this.currZoomD;this.currZoom=Math.min(Math.max(-1,
this.currZoom),1);a.preventDefault()}onMouseDown(a){this.startPos=this.camera.screenToCamera(this.pointerPosition);this.currPos.x=this.startPos.x;this.currPos.y=this.startPos.y;this.drag=0;V.postMessage("viewer.mousedown",this.cast3d)}onTouchStart(a){a=a.targetTouches;1==a.length&&(this.pointerPosition={pageX:a[0].pageX,pageY:a[0].pageY},this.onMouseDown({pageX:a[0].pageX,pageY:a[0].pageY,button:0}),V.camera.getRay(this.pointerPosition,this.pointerRay),this.cast2d=O.instance.raycast(this.pointerRay,
this.pointerPosition),V.postMessage("viewer.mousemove",this.castRay3d()),this.touchStamp=V.time,this.touchLast=a[0])}onMouseMove(a){this.currPos=this.camera.screenToCamera(a);this.shiftKey=a.shiftKey;this.pointerPosition={pageX:a.pageX,pageY:a.pageY};null!=this._timer||V.camera.moving||(this._timer=setTimeout(()=>{null!=this._timer&&V.postMessage("viewer.mousemove",this.castRay3d())},150));V.camera.getRay(this.pointerPosition,this.pointerRay)}onTouchMove(a){a=a.targetTouches;1==a.length&&(this.onMouseMove({pageX:a[0].pageX,
pageY:a[0].pageY,button:0}),this.touchLast=a[0]);this.touchStamp=0}onMouseUp(a){this.drag=this.dragMax}onMouseOut(a){this.currZoom=0;this.updateFn=null}onClick(a){a.ray=V.camera.getRay(a,this.ray);this.cast2d=O.instance.raycast(a.ray,a.pageX,a.pageY);if(0<this.cast2d.hits.length){this.cast2d.hits.sort(function(c,d){return c.distance-d.distance});var b=this.cast2d.hits[0].object;V.postMessage(b.type+".click",b.CLICK({id:b.id,type:b.type,pageX:a.pageX,pageY:a.pageY}));return!0}return!1}onDblClick(a){V.camera.getRay(this.pointerPosition,
this.pointerRay);this.castRay3d();a.ray=this.ray;if(0<this.cast2d.hits.length){var b=this.cast2d.hits[0].object;V.postMessage(b.type+".dblclick",b.DBLCLICK({id:b.id,type:b.type,pageX:a.pageX,pageY:a.pageY}));return!0}V.postMessage("viewer.dblclick",this.cast3d);return!1}onTouchEnd(a){if(0==a.targetTouches.length){a.pageX=this.touchLast.pageX;a.pageY=this.touchLast.pageY;if(300>V.time-this.touchStamp)return this.onDblClick(a);this.onMouseUp(a);return this.onClick(a)}return!1}onKeyDown(a){this.drag=
0;this.keys[a.keyCode]=!0}onKeyUp(a){V.keyCount||(this.drag=this.dragMax);delete this.keys[a.keyCode];this.startPos.x=this.currPos.x;this.startPos.y=this.currPos.y}onTouchCancel(a){}castRay3d(){let a=V.viewer.raycast(this.pointerRay,{xyz:{},normal:{},distance:Number.POSITIVE_INFINITY});a.distance!=Number.POSITIVE_INFINITY&&GM.Vector3.normalize(a.normal,a.normal);this.cast3d=a;this.pointerAge=V.time;this._timer=null;return a}};
Easing={Linear:function(a){return a},Quadratic:{In:function(a){return a*a},Out:function(a){return a*(2-a)},InOut:function(a){return 1>(a*=2)?.5*a*a:-.5*(--a*(a-2)-1)}},Cubic:{In:function(a){return a*a*a},Out:function(a){return--a*a*a+1},InOut:function(a){return 1>(a*=2)?.5*a*a*a:.5*((a-=2)*a*a+2)}},Quartic:{In:function(a){return a*a*a*a},Out:function(a){return 1- --a*a*a*a},InOut:function(a){return 1>(a*=2)?.5*a*a*a*a:-.5*((a-=2)*a*a*a-2)}},Sinusoidal:{In:function(a){return 1-Math.cos(a*Math.PI/2)},
Out:function(a){return Math.sin(a*Math.PI/2)},InOut:function(a){return.5*(1-Math.cos(Math.PI*a))}},Exponential:{In:function(a){return 0===a?0:Math.pow(1024,a-1)},Out:function(a){return 1===a?1:1-Math.pow(2,-10*a)},InOut:function(a){return 0===a?0:1===a?1:1>(a*=2)?.5*Math.pow(1024,a-1):.5*(-Math.pow(2,-10*(a-1))+2)}},Circular:{In:function(a){return 1-Math.sqrt(1-a*a)},Out:function(a){return Math.sqrt(1- --a*a)},InOut:function(a){return 1>(a*=2)?-.5*(Math.sqrt(1-a*a)-1):.5*(Math.sqrt(1-(a-=2)*a)+1)}},
Elastic:{In:function(a){var b=.1;if(0===a)return 0;if(1===a)return 1;if(!b||1>b){b=1;var c=.1}else c=.4*Math.asin(1/b)/(2*Math.PI);return-(b*Math.pow(2,10*--a)*Math.sin(2*(a-c)*Math.PI/.4))},Out:function(a){var b=.1;if(0===a)return 0;if(1===a)return 1;if(!b||1>b){b=1;var c=.1}else c=.4*Math.asin(1/b)/(2*Math.PI);return b*Math.pow(2,-10*a)*Math.sin(2*(a-c)*Math.PI/.4)+1},InOut:function(a){var b=.1;if(0===a)return 0;if(1===a)return 1;if(!b||1>b){b=1;var c=.1}else c=.4*Math.asin(1/b)/(2*Math.PI);return 1>
(a*=2)?-.5*b*Math.pow(2,10*--a)*Math.sin(2*(a-c)*Math.PI/.4):b*Math.pow(2,-10*--a)*Math.sin(2*(a-c)*Math.PI/.4)*.5+1}},Back:{In:function(a){return a*a*(2.70158*a-1.70158)},Out:function(a){return--a*a*(2.70158*a+1.70158)+1},InOut:function(a){return 1>(a*=2)?.5*a*a*(3.5949095*a-2.5949095):.5*((a-=2)*a*(3.5949095*a+2.5949095)+2)}},Bounce:{In:function(a){return 1-Easing.Bounce.Out(1-a)},Out:function(a){return a<1/2.75?7.5625*a*a:a<2/2.75?7.5625*(a-=1.5/2.75)*a+.75:a<2.5/2.75?7.5625*(a-=2.25/2.75)*a+.9375:
7.5625*(a-=2.625/2.75)*a+.984375},InOut:function(a){return.5>a?.5*Easing.Bounce.In(2*a):.5*Easing.Bounce.Out(2*a-1)+.5}}};V.KEY_CANCEL=3;V.KEY_HELP=6;V.KEY_BACK_SPACE=8;V.KEY_TAB=9;V.KEY_CLEAR=12;V.KEY_RETURN=13;V.KEY_ENTER=14;V.KEY_SHIFT=16;V.KEY_CONTROL=17;V.KEY_ALT=18;V.KEY_PAUSE=19;V.KEY_CAPS_LOCK=20;V.KEY_ESCAPE=27;V.KEY_SPACE=32;V.KEY_PAGE_UP=33;V.KEY_PAGE_DOWN=34;V.KEY_END=35;V.KEY_HOME=36;V.KEY_LEFT=37;V.KEY_UP=38;V.KEY_RIGHT=39;V.KEY_DOWN=40;V.KEY_PRINTSCREEN=44;V.KEY_INSERT=45;
V.KEY_DELETE=46;V.KEY_0=48;V.KEY_1=49;V.KEY_2=50;V.KEY_3=51;V.KEY_4=52;V.KEY_5=53;V.KEY_6=54;V.KEY_7=55;V.KEY_8=56;V.KEY_9=57;V.KEY_SEMICOLON=59;V.KEY_EQUALS=61;V.KEY_A=65;V.KEY_B=66;V.KEY_C=67;V.KEY_D=68;V.KEY_E=69;V.KEY_F=70;V.KEY_G=71;V.KEY_H=72;V.KEY_I=73;V.KEY_J=74;V.KEY_K=75;V.KEY_L=76;V.KEY_M=77;V.KEY_N=78;V.KEY_O=79;V.KEY_P=80;V.KEY_Q=81;V.KEY_R=82;V.KEY_S=83;V.KEY_T=84;V.KEY_U=85;V.KEY_V=86;V.KEY_W=87;V.KEY_X=88;V.KEY_Y=89;V.KEY_Z=90;V.KEY_CONTEXT_MENU=93;V.KEY_NUMPAD0=96;V.KEY_NUMPAD1=97;
V.KEY_NUMPAD2=98;V.KEY_NUMPAD3=99;V.KEY_NUMPAD4=100;V.KEY_NUMPAD5=101;V.KEY_NUMPAD6=102;V.KEY_NUMPAD7=103;V.KEY_NUMPAD8=104;V.KEY_NUMPAD9=105;V.KEY_MULTIPLY=106;V.KEY_ADD=107;V.KEY_SEPARATOR=108;V.KEY_SUBTRACT=109;V.KEY_DECIMAL=110;V.KEY_DIVIDE=111;V.KEY_F1=112;V.KEY_F2=113;V.KEY_F3=114;V.KEY_F4=115;V.KEY_F5=116;V.KEY_F6=117;V.KEY_F7=118;V.KEY_F8=119;V.KEY_F9=120;V.KEY_F10=121;V.KEY_F11=122;V.KEY_F12=123;V.KEY_F13=124;V.KEY_F14=125;V.KEY_F15=126;V.KEY_F16=127;V.KEY_F17=128;V.KEY_F18=129;
V.KEY_F19=130;V.KEY_F20=131;V.KEY_F21=132;V.KEY_F22=133;V.KEY_F23=134;V.KEY_F24=135;V.KEY_NUM_LOCK=144;V.KEY_SCROLL_LOCK=145;V.KEY_COMMA=188;V.KEY_PERIOD=190;V.KEY_SLASH=191;V.KEY_BACK_QUOTE=192;V.KEY_OPEN_BRACKET=219;V.KEY_BACK_SLASH=220;V.KEY_CLOSE_BRACKET=221;V.KEY_QUOTE=222;V.KEY_META=224;V.Queue=function(){this.last=this.first=null;this.size=0};V.Queue.prototype.enqueue=function(a){this.first?this.last.next=a:this.first=a;this.last=a;this.size++};
V.Queue.prototype.dequeue=function(){var a=this.first;this.first=this.first.next;null==this.first&&(this.last=null);a.next=null;this.size--;return a};V.Queue.prototype.empty=function(){return null==this.first};V.Queue.prototype.clear=function(){this.last=this.first=null;this.size=0};V.Queue.prototype.front=function(){return this.first};V.PriorityQueue=function(a){this.data=[];this.length=0;this.compare=a};
V.PriorityQueue.prototype.enqueue=function(a){this.data.push(a);this.length++;this._up(this.length-1)};V.PriorityQueue.prototype.dequeue=function(){var a=this.data[0];this.length--;0<this.length&&(this.data[0]=this.data[this.length],this._down(0));this.data.pop();return a};V.PriorityQueue.prototype.empty=function(){return 0==this.length};V.PriorityQueue.prototype.clear=function(){this.data=[];this.length=0};
V.PriorityQueue.prototype._up=function(a){for(var b=this.data,c=this.compare,d=b[a];0<a;){var e=a-1>>1,f=b[e];if(0<=c(d,f))break;b[a]=f;a=e}b[a]=d};V.PriorityQueue.prototype._down=function(a){for(var b=this.data,c=this.compare,d=this.length>>1,e=b[a];a<d;){var f=(a<<1)+1,g=f+1,h=b[f];g<this.length&&0>c(b[g],h)&&(f=g,h=b[g]);if(0<=c(h,e))break;b[a]=h;a=f}b[a]=e};
</script>
<script id="/overlay/overlay.js">O={instance:null,camera:null,DISTANCE:"distance",ANGLE:"angle",VOLUME:"volume",AREA:"area",canvas:document.getElementById("canvas2D"),units:0,numberFormat:new Intl.NumberFormat,s1:1,s2:1,s3:1,setScalar:function(a,b,c){O.s1=a;O.s2=b;O.s3=c},cursor:a=>{O.canvas.style.cursor=a},add:a=>{O.instance.addObject(a)},find:a=>O.instance.registry[a],remove:a=>{a instanceof O.Object?O.instance.removeObject(a.id):O.instance.removePanel(a)},getSelected:()=>O.instance.getSelected(),getAll:a=>{let b={};O.instance.objects.forEach(c=>
{c.type===a&&(b[c.id]=c.toJson())});return b},Component:function(a){this.style=a;this.visible=!0;this.zIndex=100;this.normal3D={x:0,y:0,z:0}}};O.Component.prototype.setVisibile=function(a){this.visible=a};
O.Object=class{constructor(a,b,c){this.id=null==a?(new Date).getTime():a;this.exclude=c;this.components=[];this.controls=[];this.anchors=[];if(this.activation=b)this.activation.easing=this.activation.easing||"Linear";this.aabb={min:{x:0,y:0,z:0},max:{x:0,y:0,z:0},center:{x:0,y:0,z:0}};this.attached=this.selected=!1;this.scale=1;this.visible=!0}CLICK(a){return a}DBLCLICK(a){return a}detach(){for(var a=0;a<this.controls.length;a++)this.controls[a].detach();this.attached=!1}attach(){for(var a=0;a<this.controls.length;a++)this.controls[a].attach();
this.attached=!0}onUpdate(a){this.activation&&this.visible&&(this.scale=Easing[this.activation.easing](V.viewer.getDistanceAlpha(this.aabb.center,this.activation.p0,this.activation.p1)))}isVisible(){return this.visible&&V.camera.intersectsBox(this.aabb)}addAnchor(a){this.anchors.push(a);return a}insertAnchor(a,b){this.anchors.splice(a,0,b);return b}removeAnchor(a){this.anchors.splice(this.anchors.indexOf(a),1)}addControl(a){this.controls.push(a);a.attach();a.addListener(this);return a}insertControl(a,
b){this.controls.splice(a,0,b);b.attach();b.addListener(this);return b}removeControl(a){[a]=this.controls.splice(this.controls.indexOf(a),1);a.detach()}addComponent(a){this.components.push(a);return a}insertComponent(a,b){this.components.splice(a,0,b);return b}removeComponent(a){this.components.splice(this.components.indexOf(a),1)}endControl(){V.touch2d()}projectAnchors(){for(var a=0;a<this.anchors.length;a++)this.anchors[a].project();var b=this.aabb.min,c=this.aabb.max,d=this.aabb.center;b.x=Number.POSITIVE_INFINITY;
b.y=Number.POSITIVE_INFINITY;b.z=Number.POSITIVE_INFINITY;c.x=Number.NEGATIVE_INFINITY;c.y=Number.NEGATIVE_INFINITY;c.z=Number.NEGATIVE_INFINITY;for(a=0;a<this.anchors.length;a++){var e=this.anchors[a];b.x=Math.min(e.wx,b.x);b.y=Math.min(e.wy,b.y);b.z=Math.min(e.wz,b.z);c.x=Math.max(e.wx,c.x);c.y=Math.max(e.wy,c.y);c.z=Math.max(e.wz,c.z)}d.x=(c.x+b.x)/2;d.y=(c.y+b.y)/2;d.z=(c.z+b.z)/2}updateUnits(){for(var a=0;a<this.components.length;a++)this.components[a].updateUnits&&this.components[a].updateUnits()}intersectRay3D(a){var b=
Number.POSITIVE_INFINITY;this.components.forEach(c=>{c.intersectRay3D&&(b=Math.min(b,c.intersectRay3D(a,this)))});return b}containsPoint2D(a){if(this.selected)for(var b=0;b<this.controls.length;b++)if(this.controls[b].containsPoint2D(a))return a.component=this.controls[b],!0;for(b=0;b<this.components.length;b++)if(this.components[b].containsPoint2D&&this.components[b].containsPoint2D(a))return a.component=this.components[b],!0;return!1}select(){this.projectAnchors();this.selected?console.log("object already selected"):
(this.selected=!0,this.onDblClick&&O.instance.addEventListener("onDblClick",this))}unselect(){this.selected=!1;for(var a=0;a<this.controls.length;a++)this.controls[a].detach();this.controls=[];this.onDblClick&&O.instance.removeEventListener("onDblClick",this)}update(a){a.hasOwnProperty("activation")&&(this.activation=a.activation,V.touch2d());a.hasOwnProperty("visible")&&(this.visible=a.visible)&&this.projectAnchors()}render2D(a){if(0<this.scale)for(var b=0;b<this.components.length;b++){var c=this.components[b];
c.visible&&c.render2D&&this.components[b].render2D(a)}}render3D(a){for(var b=0;b<this.components.length;b++)this.components[b].visible&&this.components[b].render3D&&this.components[b].render3D(a,this)}toJson(a){let b={};if(void 0==a||a.includes("id"))b.id=this.id;(void 0==a||a.includes("activation"))&&this.activation&&(b.activation=this.activation);(void 0==a||a.includes("visible"))&&this.hasOwnProperty("visible")&&(b.visible=this.visible);return b}};O.Object.INFINITE={easing:"Linear"};
O.Composite=class extends O.Object{constructor(a,b,c){super(a,b,c);this.objects=[]}detach(){super.detach();for(var a=0;a<this.objects.length;a++)this.objects[a].detach()}attach(){super.attach();for(var a=0;a<this.objects.length;a++)this.objects[a].attach()}onUpdate(a){super.onUpdate(a);if(this.activation&&V.camera.moving)for(var b=0;b<this.objects.length;b++)this.objects[b].scale=this.scale;for(b=0;b<this.objects.length;b++)this.objects[b].onUpdate(a)}addObject(a){a.attached||a.attach();this.objects.push(a);
return a}insertObject(a,b){b.attached&&b.detach();this.objects.splice(a,0,b);return b}removeObject(a){a.attached&&a.detach();this.objects.splice(this.objects.indexOf(a),1)}projectAnchors(){super.projectAnchors();for(var a=0;a<this.objects.length;a++)this.objects[a].projectAnchors()}select(){super.select();for(var a=0;a<this.objects.length;a++)this.objects[a].select()}unselect(){super.unselect();for(var a=0;a<this.objects.length;a++)this.objects[a].unselect()}render2D(a){super.render2D(a);for(var b=
0;b<this.objects.length;b++)this.objects[b].visible&&this.objects[b].render2D(a)}render3D(a){for(var b=0;b<this.objects.length;b++)this.objects[b].visible&&this.objects[b].render3D(a,this);super.render3D(a)}};
O.Overlay=class extends V.EventHandler{constructor(){super(V.EventHandler.PRIO0,V.EventHandler.PRIO3);O.canvas.width=O.canvas.clientWidth;O.canvas.height=O.canvas.clientHeight;this.context=O.canvas.getContext("2d");O.instance=this;this.objects=[];this.visibleObjects=[];this.registry={};this.points=[];this.handlers={onMouseDown:[],onMouseMove:[],onMouseUp:[],onMouseOut:[],onClick:[],onDblClick:[]};O.ControlPoint.PATH=new Path2D;O.ControlPoint.PATH.arc(0,0,O.ControlPoint.R,0,2*Math.PI);this.anchors=
{};V.recvMessage("anchor.create",a=>{if(this.anchors[a.id])V.postMessage("error","anchor already exists "+a.id);else{let b=new O.AnchorX(a,a.id);this.anchors[a.id]=b;V.postMessage("anchor.create",Object.assign(b.toJson(),{id:b.id}))}});V.recvMessage("anchor.update",a=>{this.anchors[a.id]?a.hasOwnProperty("point")&&(this.anchors[a.id].set3D(a),V.postMessage("anchor.update",Object.assign(anchor.toJson(),{id:anchor.id}))):V.postMessage("error","anchor does not exist "+a.id)});V.recvMessage("anchor.delete",
a=>{this.anchors[a.id]?(delete this.anchors[a.id],V.postMessage("anchor.delete",a)):V.postMessage("error","anchor does not exist "+a.id)});V.recvMessage("viewpoint.get",a=>{let b={};this.objects.forEach(c=>{c.exclude||c.visible||(b[c.id]=!0)});a.hidden=Object.assign(a.hidden||{},b)});V.recvMessage("viewpoint",a=>{let b=a.hidden;this.objects.forEach(c=>{c.exclude||c.visible==!b[c.id]||(c.visible=!b[c.id],V.postMessage(`${c.type}.update`,{id:c.id,visible:c.visible}))});V.touch2d()});V.recvMessage("viewer.unload",
a=>{this.objects.forEach(b=>{delete this.registry[b.id];b.detach()});this.objects=[];this.visibleObjects=[]});V.recvMessage("*.scan.stop",(a,b)=>{this.objects.forEach(c=>{"function"===typeof c.stopScan&&c.stopScan()});V.postMessage("*.selected.get",{},b);V.touch2d()});V.recvMessage("*.unselect",(a,b)=>{if(a&&a.id){let c=this.getObject(a.id);c&&(c.unselect(),V.postMessage(`${c.type}.unselect`,{id:c.id},b))}else this.objects.forEach(c=>{c.selected&&(c.unselect(),V.postMessage(`${c.type}.unselect`,{id:c.id},
b))});V.postMessage("*.unselect",a,b);V.touch2d()});V.recvMessage("*.selected.get",(a,b)=>{let c={};this.objects.forEach(d=>{d.selected&&(c[d.id]=d.toJson(a.filter))});V.postMessage("*.selected.get",c,b);V.touch2d()});V.recvMessage("*.get",(a,b)=>{this.objects.forEach(c=>{a[c.id]=c.toJson(a.filter)})});V.recvMessage("*.delete",(a,b)=>{let c=null;a.filter&&(c=Function("return "+decodeURI(entry.filter))());for(var d=this.objects.length-1;0<=d;d--){var e=this.objects[d];if(null==c||c.call(e))delete this.registry[e.id],
e.detach(),this.objects.splice(d,1),e=this.visibleObjects.indexOf(e),-1!=e&&this.visibleObjects.splice(e,1)}V.postMessage("*.delete",a,b)});V.recvMessage("record.cancel",(a,b)=>{O.Builder.get().end();V.touch2d()});V.recvMessage("viewer.update",a=>{if(a.hasOwnProperty("units"))for(a=0;a<this.objects.length;a++)this.objects[a].updateUnits()})}addEventListener(a,b,c,d){c={object:b,zIndex:null==c?999:c};c.callback=d?d:b[a].bind(b);a=this.handlers[a];a.push(c);for(b=a.length-1;0<b;b--)a[b].zIndex<a[b-
1].zIndex&&(d=a[b-1],a[b-1]=a[b],a[b]=d)}removeEventListener(a,b){a=this.handlers[a];for(var c=0;c<a.length;c++)if(a[c].object===b){a.splice(c,1);break}}onMouseDown(a){for(var b=this.handlers.onMouseDown,c=0;c<b.length;c++)if(b[c].object.containsPoint2D(a)){b[c].callback(a);break}}onMouseMove(a){for(var b=this.handlers.onMouseMove,c=0;c<b.length;c++)b[c].callback(a)}onMouseUp(a){for(var b=this.handlers.onMouseUp,c=0;c<b.length;c++)b[c].callback(a)}onMouseOut(a){for(var b=this.handlers.onMouseOut,
c=0;c<b.length;c++)b[c].callback(a)}onClick(a){for(var b=this.handlers.onClick,c=0;c<b.length;c++)if(b[c].object.containsPoint2D){if(b[c].object.containsPoint2D(a)){b[c].callback(a);break}}else if(b[c].callback(a))break}onDblClick(a){for(var b=this.handlers.onDblClick,c=0;c<b.length;c++)if(b[c].object.containsPoint2D){if(b[c].object.containsPoint2D(a)){b[c].callback(a);break}}else{b[c].callback(a);break}}onUpdate(a){this.visibleObjects=[];this.objects.forEach(b=>{b.isVisible()&&this.visibleObjects.push(b)});
this.visibleObjects.forEach(b=>{b.onUpdate(a)});V.camera.moving&&(this.updateAnchors=!0)}onRender3D(a){this.updateAnchors&&(this.points.forEach(b=>b.anchor.project()),this.visibleObjects.forEach(b=>b.projectAnchors()),Object.keys(this.anchors).forEach(b=>this.anchors[b].project()),this.updateAnchors=!1);this.visibleObjects.forEach(b=>{b.render3D&&b.visible&&b.render3D(a)})}onRender2D(a){this.context.clearRect(0,0,O.canvas.width,O.canvas.height);this.context.beginPath();a.background&&this.context.drawImage(a.background,
0,0);this.context.save();for(a=0;a<this.visibleObjects.length;a++)this.visibleObjects[a].visible&&this.visibleObjects[a].render2D(this.context);this.context.restore();this.context.save();this.context.lineWidth=3;for(a=0;a<this.points.length;a++)this.points[a].render2D(this.context);this.context.lineWidth=1;this.context.restore()}onResize(a){O.canvas.width=a.width;O.canvas.height=a.height;this.updateAnchors=!0;for(var b=0;b<this.visibleObjects.length;b++)if(this.visibleObjects[b].onResize)this.visibleObjects[b].onResize(a)}getSelected(a){for(a=
0;a<this.objects.length;a++)if(this.objects[a].selected)return this.objects[a];return null}createControlPoint(a,b){a=b.getPoint(a);return null!=a?(b=new O.ControlPoint(new O.Anchor(a),b),b.attach(),b):null}removeControlPoint(a){for(var b=0;b<this.points.length;b++)if(this.points[b]==a){this.points.splice(b,1);break}}addControlPoint(a){this.points.push(a)}addObject(a){a.attach();this.objects.push(a);this.registry[a.id]=a;this.updateAnchors=!0;this.visibleObjects.push(a)}removeObject(a){for(var b=0;b<
this.objects.length;b++)if(this.objects[b].id==a)return a=this.objects[b],delete this.registry[a.id],a.detach(),this.objects.splice(b,1),b=this.visibleObjects.indexOf(a),-1!=b&&this.visibleObjects.splice(b,1),a;return null}raycast(a,b,c){var d={ray:a,distance:Number.POSITIVE_INFINITY,pageX:b,pageY:c,hits:[]};this.context.save();this.visibleObjects.forEach(e=>{let f=e.intersectRay3D(d);0<e.scale&&f!=Number.POSITIVE_INFINITY&&d.hits.push({distance:f,object:e})});this.context.restore();return d}getObject(a){return this.registry[a]}};
O.Builder=class extends V.EventHandler{constructor(){super(V.EventHandler.PRIO1);this.points=[]}start(a){this.tool&&this.end();this.tool=a;O.cursor("crosshair");this.attach()}end(){this.points.forEach(a=>a.detach());this.points=[];this.tool=null;O.cursor("default");this.isAttached()&&this.detach()}onClick(a){let b=this.tool.addPoint(a,this.escaped);if(b&&(this.points.push(b),this.tool.isDone(this.points))){var c=[];this.points.forEach(d=>c.push(d.anchor.toJson()));this.tool.complete(c);this.end()}a.stopImmediatePropagation()}onKeyUp(a){27==
a.keyCode?(this.escaped=!0,this.tool.isDone(a.keyCode)&&this.end()):8==a.keyCode&&this.removePoint&&this.removePoint()}};O.Builder.get=function(){O.Builder.instance||(O.Builder.instance=new O.Builder);return O.Builder.instance};
</script>
<script id="/overlay/anchor.js">O.Anchor=class{constructor(a){a?(this.wx=a.x||0,this.wy=a.y||0,this.wz=a.z||0):this.wz=this.wy=this.wx=0;this.listener=[];this.id=O.Anchor.nextId++;this.project()}between3D(a,b,c){return new O.Anchor({x:a.wx+(b.wx-a.wx)*c,y:a.wy+(b.wy-a.wy)*c,z:a.wz+(b.wz-a.wz)*c})}set3D(a){this.wx=a.x;this.wy=a.y;this.wz=a.z;for(a=0;a<this.listener.length;a++)this.listener[a].update3D&&this.listener[a].update3D();this.project()}translate3D(a,b,c){this.wx+=a;this.wy+=b;this.wz+=c;this.px=this.wx;this.py=this.wy;this.pz=
this.wz;for(a=0;a<this.listener.length;a++)this.listener[a].update3D&&this.listener[a].update3D();this.project()}project(){var a=V.camera.project({x:this.wx,y:this.wy,z:this.wz});this.sx=a.x*O.canvas.width;this.sy=a.y*O.canvas.height}move2D(a){this.sx=a.pageX;this.sy=a.pageY}addListener(a){this.listener.push(a)}removeListener(a){for(var b=0;b<this.listener.length;b++)if(this.listener[b]==a){this.listener.splice(b,1);break}}toJson(a){return{x:this.wx,y:this.wy,z:this.wz}}};O.Anchor.nextId=1;
O.AnchorX=class extends O.Anchor{constructor(a,b){super(a);this.id=b}project(){super.project();0<this.sx&&this.sx<O.canvas.width&&0<this.sy&&this.sy<O.canvas.height&&V.postMessage("anchor.update",{id:this.id,xyz:{x:this.wx,y:this.wy,z:this.wz},uv:{x:this.sx,y:this.sy}})}};
O.ControlPoint=class{constructor(a,b){this.constraint=b;this.anchor=a;this.anchor.addListener(this);this.zIndex=0;this.visible=!0;this.timer=null;this.click=function(c){c.preventDefault();c.stopPropagation()};this.listener=[]}detach(){O.instance.removeEventListener("onMouseDown",this);O.instance.removeControlPoint(this)}attach(){O.instance.addControlPoint(this);O.instance.addEventListener("onMouseDown",this,0)}updateAnchor(a){a=this.constraint.moveControl(a,this);if(null!=a){this.anchor.set3D(a);
for(var b=0;b<this.listener.length;b++)void 0!=this.listener[b].moveControl&&this.listener[b].moveControl(this);O.cursor("crosshair")}else O.cursor("not-allowed");return a}onMouseDown(a){O.instance.addEventListener("onMouseUp",this,0);O.instance.addEventListener("onMouseMove",this,0);O.instance.addEventListener("onMouseOut",this,0);for(var b=0;b<this.listener.length;b++)void 0!=this.listener[b].startControl&&this.listener[b].startControl(this);this.dragEvent={pageX:a.pageX,pageY:a.pageY};O.cursor("crosshair");
a.stopImmediatePropagation()}onMouseMove(a){this.constraint instanceof C.Intersect?(this.anchor.move2D(a),null==this.timer&&(this.timer=setTimeout(function(){null!=this.timer&&(this.updateAnchor(this.dragEvent),this.timer=null)}.bind(this),400)),this.dragEvent={pageX:a.pageX,pageY:a.pageY}):(this.dragEvent={pageX:a.pageX,pageY:a.pageY},this.updateAnchor(this.dragEvent));V.touch2d();a.stopImmediatePropagation()}onMouseUp(a){O.instance.removeEventListener("onMouseUp",this);O.instance.removeEventListener("onMouseMove",
this);O.instance.removeEventListener("onMouseOut",this);null!=this.timer&&(clearTimeout(this.timer),this.timer=null);this.updateAnchor(a)||this.anchor.project();for(var b=0;b<this.listener.length;b++)void 0!=this.listener[b].endControl&&this.listener[b].endControl(this);O.cursor("default");a.stopImmediatePropagation()}onMouseOut(a){this.onMouseUp(a)}containsPoint2D(a){var b=a.pageX-this.anchor.sx;a=a.pageY-this.anchor.sy;return b*b+a*a<O.ControlPoint.R2}addListener(a){this.listener.push(a)}removeListener(a){for(var b=
0;b<this.listener.length;b++)if(this.listener[b]==a){this.listener.splice(b,1);break}}render2D(a){this.visible&&(a.strokeStyle=this.constraint.strokeStyle,a.setTransform(1,0,0,1,this.anchor.sx,this.anchor.sy),a.stroke(O.ControlPoint.PATH))}};O.ControlPoint.R=7;O.ControlPoint.R2=O.ControlPoint.R*O.ControlPoint.R;O.ControlPoint.PATH=null;
C={create:function(a){return"Cloud"===a[0]?new C.Intersect(a[1]):C[a[0]]?new C[a[0]](a[1]):C.Intersect.instance},p:{x:0,y:0,z:0},Plane:function(a){this.plane=a;this.strokeStyle=C.Plane.ACTIVE}};C.Plane.ACTIVE="#66FF00";C.Plane.PASSIVE="#4FC40F";C.Plane.prototype.moveControl=function(a){return this.getPoint(a)};
C.Plane.prototype.getPoint=function(a){a=V.camera.getRay(a);var b=-(this.plane.x*a.origin.x+this.plane.y*a.origin.y+this.plane.z*a.origin.z-this.plane.w)/(this.plane.x*a.direction.x+this.plane.y*a.direction.y+this.plane.z*a.direction.z);C.p.x=a.direction.x*b+a.origin.x;C.p.y=a.direction.y*b+a.origin.y;C.p.z=a.direction.z*b+a.origin.z;return C.p};C.Plane.prototype.toJson=function(){return["Plane",this.plane]};C.Intersect=function(){this.strokeStyle=C.Intersect.ACTIVE};C.Intersect.ACTIVE="#40C4FF";
C.Intersect.PASSIVE="#40C4FF";C.Intersect.prototype.moveControl=function(a){return this.getPoint(a)};C.Intersect.prototype.getPoint=function(a){a=V.camera.getRay(a);a=V.viewer.raycast(a,{distance:Number.POSITIVE_INFINITY,xyz:{}});return a.distance!=Number.POSITIVE_INFINITY?(C.p.x=a.xyz.x,C.p.y=a.xyz.y,C.p.z=a.xyz.z,C.p):null};C.Intersect.prototype.toJson=function(){return["Intersect"]};C.Intersect.instance=new C.Intersect;
C.Segment=function(a,b){this.anchor0=a;this.anchor1=b;this.t=0;this.strokeStyle=C.Segment.ACTIVE};C.Segment.ACTIVE="green";C.Segment.PASSIVE="#c2a90f";
C.Segment.prototype.moveControl=function(a){a=V.camera.getRay(a);var b=this.anchor0.wx-a.origin.x,c=this.anchor0.wy-a.origin.y,f=this.anchor0.wz-a.origin.z,e=this.anchor1.wx-this.anchor0.wx,d=this.anchor1.wy-this.anchor0.wy,g=this.anchor1.wz-this.anchor0.wz,h=Math.sqrt(e*e+d*d+g*g);e/=h;d/=h;g/=h;var k=e*a.direction.x+d*a.direction.y+g*a.direction.z;this.t=Math.min(h,Math.max(0,(k*(a.direction.x*b+a.direction.y*c+a.direction.z*f)-(e*b+d*c+g*f))/(1-k*k)));C.p.x=this.t*e+this.anchor0.wx;C.p.y=this.t*
d+this.anchor0.wy;C.p.z=this.t*g+this.anchor0.wz;this.t/=h;return C.p};C.Segment.prototype.toJson=function(){return["Segment"]};C.Ray=function(a,b){this.nx=b.x;this.ny=b.y;this.nz=b.z;this.anchor=a;this.strokeStyle=C.Ray.ACTIVE};C.Ray.ACTIVE="yellow";C.Ray.PASSIVE="#c2a90f";
C.Ray.prototype.moveControl=function(a){var b=V.camera.getRay(a),c=this.anchor.wx-b.origin.x,f=this.anchor.wy-b.origin.y,e=this.anchor.wz-b.origin.z;a=this.nx*b.direction.x+this.ny*b.direction.y+this.nz*b.direction.z;var d=this.nx*c+this.ny*f+this.nz*e;b=b.direction.x*c+b.direction.y*f+b.direction.z*e;c=1-a*a;return.001<c?(a=Math.max(0,(a*b-d)/c),C.p.x=a*this.nx+this.anchor.wx,C.p.y=a*this.ny+this.anchor.wy,C.p.z=a*this.nz+this.anchor.wz,C.p):null};C.Ray.prototype.toJson=function(){return["Ray"]};
C.Line=function(a,b){this.nx=b.x;this.ny=b.y;this.nz=b.z;this.anchor=a;this.strokeStyle=C.Line.ACTIVE};C.Line.ACTIVE=C.Ray.ACTIVE;C.Line.PASSIVE=C.Ray.PASSIVE;C.Line.prototype.moveControl=function(a){return this.getPoint(a)};
C.Line.prototype.getPoint=function(a){var b=V.camera.getRay(a),c=this.anchor.wx-b.origin.x,f=this.anchor.wy-b.origin.y,e=this.anchor.wz-b.origin.z;a=this.nx*b.direction.x+this.ny*b.direction.y+this.nz*b.direction.z;var d=this.nx*c+this.ny*f+this.nz*e;b=b.direction.x*c+b.direction.y*f+b.direction.z*e;c=1-a*a;return.001<c?(a=(a*b-d)/c,C.p.x=a*this.nx+this.anchor.wx,C.p.y=a*this.ny+this.anchor.wy,C.p.z=a*this.nz+this.anchor.wz,C.p):null};C.Horizontal=function(a,b){this.anchor=a;this.strokeStyle=C.Line.ACTIVE};
C.Horizontal.ACTIVE=C.Ray.ACTIVE;C.Horizontal.PASSIVE=C.Ray.PASSIVE;C.Horizontal.prototype.moveControl=function(a){return this.getPoint(a)};
C.Horizontal.prototype.getPoint=function(a){var b=V.camera.getRay(a),c=this.anchor.wx-b.origin.x,f=this.anchor.wy-b.origin.y,e=this.anchor.wz-b.origin.z;a=V.camera.xAxis;var d=a.x*b.direction.x+a.y*b.direction.y+a.z*b.direction.z,g=a.x*c+a.y*f+a.z*e;b=b.direction.x*c+b.direction.y*f+b.direction.z*e;c=1-d*d;return.001<c?(d=(d*b-g)/c,C.p.x=d*a.x+this.anchor.wx,C.p.y=d*a.y+this.anchor.wy,C.p.z=d*a.z+this.anchor.wz,C.p):null};C.Sphere=function(a,b){this.strokeStyle=C.Plane.ACTIVE};C.Sphere.ACTIVE=C.Plane.ACTIVE;
C.Sphere.PASSIVE=C.Plane.PASSIVE;C.Sphere.prototype.moveControl=function(a){return this.getPoint(a)};C.Sphere.prototype.getPoint=function(a){a=V.camera.getRay(a);C.p.x=.708*a.direction.x;C.p.y=.708*a.direction.y;C.p.z=.708*a.direction.z;return C.p};C.Sphere.prototype.toJson=function(){return["Sphere"]};C.Polygon=function(a){this.geometry=a;this.strokeStyle=C.Plane.ACTIVE};
C.Polygon.prototype.moveControl=function(a,b){a=GM.Ray.intersectPlane(V.camera.getRay(a),this.geometry.plane,{});return this.geometry.canMovePoint(b.anchor.id,a)?a:null};C.Polygon.prototype.getPoint=function(a){return GM.Ray.intersectPlane(V.camera.getRay(a),this.geometry.plane,{})};C.Polygon.prototype.toJson=function(){return["Polygon",this.geometry.plane]};
</script>
<script id="/overlay/component.js">O.Style={FRONT:1,BACK:2,FRONT_BACK:3,NONE:0,A:8};
O.Style.Line=class{constructor(a,b,c){this.selected=!1;this.lineWidth=1;this.fillStyle=b||"red";this.dash=a;this.arrows=c}render2d(a,b,c,d,e,g){var k=d-b,h=e-c,f=Math.atan2(h,k);a.setTransform(1,0,0,1,b,c);a.beginPath();a.moveTo(0,0);a.lineTo(k,h);a.lineWidth=this.lineWidth;a.strokeStyle=this.fillStyle;this.dash&&a.setLineDash(this.dash);a.stroke();this.dash&&a.setLineDash([]);a.lineWidth=1;if(this.arrows==O.Style.FRONT||this.arrows==O.Style.FRONT_BACK)a.beginPath(),a.moveTo(k,h),a.lineTo(k-12*Math.cos(f-
Math.PI/7),h-12*Math.sin(f-Math.PI/7)),a.lineTo(k-12*Math.cos(f+Math.PI/7),h-12*Math.sin(f+Math.PI/7)),a.fillStyle=this.fillStyle,a.fill();if(this.arrows==O.Style.BACK||this.arrows==O.Style.FRONT_BACK)a.beginPath(),a.moveTo(0,0),a.lineTo(12*Math.cos(f-Math.PI/7),12*Math.sin(f-Math.PI/7)),a.lineTo(12*Math.cos(f+Math.PI/7),12*Math.sin(f+Math.PI/7)),a.fillStyle=this.fillStyle,a.fill();g&&g.size.width*g.size.width<.25*(k*k+h*h)&&(f=b<d?-f:Math.PI-f,k=Math.cos(f),f=Math.sin(f),a.setTransform(k,-f,f,k,
(b+d)/2,(c+e)/2),a.fillStyle="rgba(255,255,255,0.7)",b=O.Style.A,c=g.size.width+2*O.Style.A,d=12+O.Style.A,e=-c/2,f=-d+-3,a.moveTo(e+b,f),a.lineTo(e+c-b,f),a.quadraticCurveTo(e+c,f,e+c,f+b),a.lineTo(e+c,f+d-b),a.quadraticCurveTo(e+c,f+d,e+c-b,f+d),a.lineTo(e+b,f+d),a.quadraticCurveTo(e,f+d,e,f+d-b),a.lineTo(e,f+b),a.quadraticCurveTo(e,f,e+b,f),a.fill(),a.font="12px Arial",a.textAlign="center",a.textBaseline="bottom",a.fillStyle="blue",a.fillText(g.text,0,-3-O.Style.A/2+1))}containsPoint2d(a,b,c,d,
e){d-=b;e-=c;let g=((a.pageX-b)*d+(a.pageY-c)*e)/(d*d+e*e);0>g?g=0:1<g&&(g=1);d=a.pageX-g*d-b;e=a.pageY-g*e-c;return 225>d*d+e*e}createLabel(a,b){a=V.to1DUnitString(b);O.instance.context.font="12px Arial";return{text:a,size:O.instance.context.measureText(a)}}};
O.Style.Line.Custom=class{constructor(a,b){this.selected=!1;this.exec={};a.init&&(this.exec.init=Function("return "+decodeURI(a.init))());a.render2d&&(this.exec.render2d=Function("return "+decodeURI(a.render2d))());a.intersect2d&&(this.exec.intersect2d=Function("return "+decodeURI(a.intersect2d))());a.update&&(this.exec.update=Function("return "+decodeURI(a.update))());this.scope=Object.assign({},b);this.exec.init&&this.exec.init.call(this.scope)}render2d(a,b,c,d,e,g){this.exec.render2d.call(this.scope,
a,{x0:b,y0:c,x1:d,y1:e,t:V.time,dt:V.dT,label:g,selected:this.selected})&&V.touch2d()}containsPoint2d(a,b,c,d,e){return this.exec.intersect2d?this.exec.intersect2d.call(this.scope,O.instance.context,a.pageX,a.pageY,{x0:b,y0:c,x1:d,y1:e}):!1}update(a){a&&(this.exec.update?this.exec.update.call(this.scope,a):Object.assign(this.scope,a))}};
O.Segment=class extends O.Component{constructor(a,b,c,d){super(d);this.anchor0=a;this.anchor0.addListener(this);this.anchor1=b;this.anchor1.addListener(this);this.text=c;this.update3D()}update3D(){if(this.text){let a=G.sx*(this.anchor0.wx-this.anchor1.wx),b=G.sy*(this.anchor0.wy-this.anchor1.wy),c=G.sz*(this.anchor0.wz-this.anchor1.wz);this.label=this.style.createLabel(this.text,Math.sqrt(a*a+b*b+c*c))}}updateUnits(){if(this.text){let a=G.sx*(this.anchor0.wx-this.anchor1.wx),b=G.sy*(this.anchor0.wy-
this.anchor1.wy),c=G.sz*(this.anchor0.wz-this.anchor1.wz);this.label=this.style.createLabel(this.text,Math.sqrt(a*a+b*b+c*c))}}updateLabel(a){if(this.text=a){a=G.sx*(this.anchor0.wx-this.anchor1.wx);let b=G.sy*(this.anchor0.wy-this.anchor1.wy),c=G.sz*(this.anchor0.wz-this.anchor1.wz);this.label=this.style.createLabel(this.text,Math.sqrt(a*a+b*b+c*c))}else delete this.label}intersectRay3D(a){return this.containsPoint2D(a)?V.camera.distanceTo({x:this.anchor0.wx,y:this.anchor0.wy,z:this.anchor0.wz}):
Number.POSITIVE_INFINITY}containsPoint2D(a){return this.style.containsPoint2d(a,this.anchor0.sx,this.anchor0.sy,this.anchor1.sx,this.anchor1.sy)}render2D(a){this.style.render2d(a,this.anchor0.sx,this.anchor0.sy,this.anchor1.sx,this.anchor1.sy,this.label)}};
O.Style.Arc=class{constructor(a,b,c){this.selected=!1;this.fillStyle=b;this.dash=a;this.labelled=c;this.length2=0}line(a){a.strokeStyle=this.fillStyle;this.dash&&a.setLineDash(this.dash);a.stroke();this.dash&&a.setLineDash([])}render2d(a,b,c,d,e,g,k,h,f){var l=b-d,m=c-e;b=Math.sqrt(l*l+m*m);l/=b;m/=b;c=Math.atan2(m,l);g-=d;var n=k-e,p=Math.sqrt(g*g+n*n);g/=p;n/=p;k=Math.atan2(n,g);1>Math.abs(g*l+n*m)+.05&&(b=Math.min(b,p)/2.7,a.setTransform(1,0,0,1,d,e),a.beginPath(),a.arc(0,0,b,c,k,0<GM.Vector3.dot(V.camera.zAxis,
h)),a.strokeStyle=this.fillStyle,this.dash&&a.setLineDash(this.dash),a.stroke(),this.dash&&a.setLineDash([]),f&&f.size.width*f.size.width<b*b*.7&&(h=l+g,l=m+n,m=Math.sqrt(h*h+l*l),k=Math.PI/2-(c+k)/2,c=-Math.cos(k),k=-Math.sin(k),a.setTransform(c,-k,k,c,d+h/m*b,e+l/m*b),d=O.Style.A,e=f.size.width+2*O.Style.A,c=12+O.Style.A,h=-e/2,b=-c+-3,a.beginPath(),a.fillStyle="rgba(255,255,255,0.7)",a.moveTo(h+d,b),a.lineTo(h+e-d,b),a.quadraticCurveTo(h+e,b,h+e,b+d),a.lineTo(h+e,b+c-d),a.quadraticCurveTo(h+e,
b+c,h+e-d,b+c),a.lineTo(h+d,b+c),a.quadraticCurveTo(h,b+c,h,b+c-d),a.lineTo(h,b+d),a.quadraticCurveTo(h,b,h+d,b),a.fill(),a.font="12px Arial",a.textAlign="center",a.textBaseline="bottom",a.fillStyle="blue",a.fillText(f.text,0,-3-O.Style.A/2+1)))}createLabel(a,b){a=b.toFixed(0)+String.fromCharCode(176);O.instance.context.font="12px Arial";return{text:a,size:O.instance.context.measureText(a)}}};
O.Arc=class extends O.Component{constructor(a,b,c,d,e){super(e);this.anchor1=b;this.anchor1.addListener(this);this.anchor0=a;this.anchor0.addListener(this);this.anchor2=c;this.anchor2.addListener(this);this.text=d;this.angle=0;this.update3D()}update3D(){var a=this.anchor0.wx-this.anchor1.wx,b=this.anchor0.wy-this.anchor1.wy,c=this.anchor0.wz-this.anchor1.wz,d=Math.sqrt(a*a+b*b+c*c);a/=d;b/=d;c/=d;d=this.anchor2.wx-this.anchor1.wx;var e=this.anchor2.wy-this.anchor1.wy,g=this.anchor2.wz-this.anchor1.wz,
k=Math.sqrt(d*d+e*e+g*g);d/=k;e/=k;g/=k;this.angle=180*Math.acos(a*d+b*e+c*g)/Math.PI;this.normal3D.x=b*g-c*e;this.normal3D.y=c*d-a*g;this.normal3D.z=a*e-b*d;this.text&&(this.label=this.style.createLabel(this.text,this.angle))}updateLabel(a){(this.text=a)?this.label=this.style.createLabel(this.text,this.angle):delete this.label}render2D(a){this.style.render2d(a,this.anchor0.sx,this.anchor0.sy,this.anchor1.sx,this.anchor1.sy,this.anchor2.sx,this.anchor2.sy,this.normal3D,this.label)}};
</script>
<script id="/overlay/point.js">O.Point=class extends O.Object{constructor(a){super(a.id,a.activation,a.exclude);this.type="point";this.visible=a.visible;this.constraint=C.create(a.constraint);this.anchor=this.addAnchor(new O.Anchor(a.point));this.projectAnchors();this.exec={};a.code.init&&(this.exec.init=Function("return "+decodeURI(a.code.init))());a.code.render2d&&(this.exec.render2d=Function("return "+decodeURI(a.code.render2d))());a.code.update&&(this.exec.update=Function("return "+decodeURI(a.code.update))());a.code.intersect&&
(this.exec.intersect=Function("return "+decodeURI(a.code.intersect))());this.scope=Object.assign({},a.scope);this.exec.init&&this.exec.init.call(this.scope);this.source={code:a.code,scope:a.scope};this.meta=a.meta}CLICK(a){a.point={x:this.anchor.wx,y:this.anchor.wy,z:this.anchor.wz};a.meta=this.meta;return a}DBLCLICK(a){a.point={x:this.anchor.wx,y:this.anchor.wy,z:this.anchor.wz};a.meta=this.meta;return a}update(a){super.update(a);a.point&&(this.anchor.set3D(a.point),this.projectAnchors());a.scope&&
(this.source.scope=Object.assign(this.source.scope,a.scope),this.exec.update?this.exec.update.call(this.scope,this.source.scope):Object.assign(this.scope,a.scope));a.meta&&(this.meta=Object.assign({},a.meta));V.touch2d();V.touch3d()}containsPoint2D(a){return this.exec.intersect?this.exec.intersect.call(this.scope,O.instance.context,a.pageX,a.pageY,{scale:this.scale,x:this.anchor.sx,y:this.anchor.sy}):!1}intersectRay3D(a){return this.containsPoint2D(a)?V.camera.distanceTo({x:this.anchor.wx,y:this.anchor.wy,
z:this.anchor.wz}):Number.POSITIVE_INFINITY}render2D(a){this.exec.render2d&&(a.setTransform(this.scale,0,0,this.scale,this.anchor.sx,this.anchor.sy),this.exec.render2d.call(this.scope,a,{scale:this.scale,x:this.anchor.sx,y:this.anchor.sy,t:V.time,dt:V.dT,selected:this.selected})&&V.touch2d())}select(){super.select();this.addControl(new O.ControlPoint(this.anchor,this.constraint))}endControl(){super.endControl();V.postMessage("point.update",this.toJson())}toJson(a){let b={};if(void 0==a||a.includes("type"))b.type=
this.type;if(void 0==a||a.includes("point"))b.point=this.anchor.toJson();if(void 0==a||a.includes("code"))b.code=this.source.code;if(void 0==a||a.includes("scope"))b.scope=this.source.scope;return Object.assign(super.toJson(a),b)}};
O.Point.validate=a=>{if(!a.point)return V.postMessage("error","No coordinates supplied"),!1;if(O.find(a.id))return V.postMessage("error",`Duplicate point ID : ${a.id}`),!1;if(!a.hasOwnProperty("code"))return V.postMessage("error","Point requires a code object"),!1;a.hasOwnProperty("visible")||(a.visible=!0);a.hasOwnProperty("constraint")||(a.constraint=V.viewer.getConstraint());return!0};
O.Point.Builder=class{constructor(a,b){this.config=a||{};this.custom=b;this.constraint=V.viewer.getConstraint()}addPoint(a,b){return O.instance.createControlPoint(a,this.constraint)}removePoint(a){}isDone(a){return 1==a.length}complete(a){this.config.type="point";this.config.point=a[0];this.config.constraint=this.constraint.toJson();V.postMessage("point.record",this.config,this.custom)}};V.recvMessage("point.record",(a,b)=>{O.Builder.get().start(new O.Point.Builder(a,b))});
V.recvMessage("point.create",(a,b)=>{if(O.Point.validate(a)){a=new O.Point(a);if(b.transform){let c=V.viewer.datasets[b.transform];c&&c.addAnchors(a)}O.instance.addObject(a);V.postMessage("point.create",a.toJson(),b);V.touch3d();V.touch2d()}});V.recvMessage("point.delete",function(a,b){if(b.transform&&(b=V.viewer.datasets[b.transform])){let c=O.instance.getObject(a.id);b.removeAnchors(c)}O.instance.removeObject(a.id);V.postMessage("point.delete",a);V.touch2d()});
V.recvMessage("point.update",function(a,b){var c=O.instance.getObject(a.id);c&&(c.update(a),V.postMessage("point.update",a,b),V.touch2d(),V.touch3d())});V.recvMessage("point.select",function(a,b){if(a=O.instance.getObject(a.id))a.select(),V.postMessage("point.select",a.toJson(),b),V.touch2d()});V.recvMessage("point.unselect",function(a,b){var c=O.instance.getObject(a.id);c&&(c.unselect(),V.postMessage("point.unselect",a,b),V.touch2d())});
V.recvMessage("point.get",(a,b)=>{if(a&&a.id){var c=O.instance.getObject(a.id);c&&V.postMessage("point.get",c.toJson(a.filter),b)}else V.postMessage("point.get",O.getAll("point"),b)});
</script>
<script id="/1d/index.js">var V1={};
V1.Viewer=class extends V.Viewer{constructor(a){super({alpha:!1,depth:!1});gl.disable(gl.DEPTH_TEST);gl.disable(gl.CULL_FACE);gl.cullFace(gl.BACK);V.camera=new V1.Camera(this.canvas,new GM.PerspectiveProjection(100));V.camera.moving=!0;this.controller=new V1.Controller(V.EventHandler.PRIO3);this.controller.attach();this.shader=new V1.Shader;this.shader.compile();this.animate();V.recvMessage("*.get",(c,b)=>{V.postMessage("*.get",c,b)});V.recvMessage("viewpoint.get",c=>{for(var b in this.datasets)c[b]=this.datasets[b].getViewpoint();
V.postMessage("viewpoint.get",c)})}render(){V.camera.updateMatrix();for(var a in this.datasets)this.datasets[a].render(this)}toJson(a){a.controller=this.controller.toJson();return a}getDistanceAlpha(a,c,b){return GM.clamp((this.controller.maxFov-V.camera.projection.fovH)/(this.controller.maxFov-b)+(b-this.controller.minFov),0,1)}getConstraint(a){return C.create(["Sphere"])}};
V1.Camera=class extends GM.CameraMVP{constructor(a,c){super(a,c);V.recvMessage("camera.get",b=>{b=this.toJson();b.minFov=Math.tan(25*GM.DEG2RAD);b.maxFov=Math.tan(55*GM.DEG2RAD);V.postMessage("camera.get",b)});V.recvMessage("camera.set",b=>{this.set(b)})}distanceTo(a){return 0}};
V1.Controller=class extends V.CameraController{constructor(){super(V.EventHandler.PRIO1,V.EventHandler.PRIO1,V.camera,6);this.camera.projection.setRange(.1,100);this.minFov=Math.tan(25*GM.DEG2RAD);this.maxFov=Math.tan(55*GM.DEG2RAD);this.fov1=this.fov0=this.camera.projection.fovH;V.recvMessage("viewpoint.get",a=>{a.rotation=this.camera.rotation.toJson();a.fovH=this.camera.projection.fovH});V.recvMessage("viewpoint",a=>{this.fov0=this.camera.projection.fovH;this.fov1=a.fovH;this.tweenRotation(a.rotation);
this.tweenStart(this.zoomFn0)})}rotateFn(a){a=(this.currPos.x-this.startPos.x)/4;var c=(this.currPos.y-this.startPos.y)/2;this.startPos.x+=a;this.startPos.y+=c;this.camera.rotation.x=GM.clamp(this.camera.rotation.x+c,-1.57079632679,1.57079632679);this.camera.rotation.y-=(this.shiftKey?.1:1)*a;this.camera.rotation.z=0}zoomFn0(a){this.camera.projection.fovH=this.fov0+(this.fov1-this.fov0)*Easing.Sinusoidal.InOut(this.rotation.sT)}zoomFn1(a){5E-4<Math.abs(this.fov0-this.fov1)?(this.fov0+=.6*(this.fov1-
this.fov0),this.camera.projection.fovH=this.fov0,this.camera.moving=!0):this.updateFn=null}onMouseWheel(a){super.onMouseWheel(a);this.fov1+=this.getWheelDelta(a);this.fov1=GM.clamp(this.fov1,this.minFov,this.maxFov);this.updateFn=this.zoomFn1}onMouseDown(a){super.onMouseDown(a);this.updateFn=this.rotateFn}onTouchStart(a){super.onTouchStart(a);this.updateFn=this.rotateFn}};V1.Shader=function(){GL.ShaderMVP.call(this,V1.Shader.vs,V1.Shader.fs)};V1.Shader.prototype=Object.create(GL.ShaderMVP.prototype);
V1.Shader.prototype.compile=function(){GL.ShaderMVP.prototype.compile.call(this);this.defineAttribute("uv",2,gl.FLOAT,!1);this.defineAttribute("position",3,gl.FLOAT,!1);this.samplerMap=gl.getUniformLocation(this.glId,"samplerMap")};V1.Shader.prototype.useProgram=function(a){GL.ShaderMVP.prototype.useProgram.call(this,a)};V1.Shader.vs="\nattribute vec3 position;\nattribute vec2 uv;\n\nuniform mat4 modelViewMatrix; \nuniform mat4 projectionMatrix; \n\nvarying mediump vec2 texCoord;\n    \nvoid main(void) \n{\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n    \n    texCoord = uv;\n}";
V1.Shader.fs="\nvarying mediump vec2 texCoord;\n\nuniform sampler2D samplerMap;\n\nvoid main(void) \n{\n    gl_FragColor = texture2D(samplerMap, texCoord);\n}";
</script>
<script id="/1d/image.js">M.Node=function(a,b,d,e){this.image=a;this.z=b.z;this.y=b.y;this.x=b.x;this.glTextureId=d;this.parent=e;this.vbo={position:new GL.ArrayBuffer(b.v)};a=b.v;b.z<this.image.maxZoom&&(this.c00={parent:this,quadrant:"c00",z:b.z+1,x:2*b.x,y:2*b.y,f:b.f,v:new Float32Array([a[0],a[1],a[2],.5*a[0]+.5*a[3],.5*a[1]+.5*a[4],.5*a[2]+.5*a[5],.5*a[0]+.5*a[6],.5*a[1]+.5*a[7],.5*a[2]+.5*a[8],.5*a[0]+.5*a[9],.5*a[1]+.5*a[10],.5*a[2]+.5*a[11]])},this.c10={parent:this,quadrant:"c10",z:b.z+1,x:2*b.x+1,y:2*b.y,f:b.f,v:new Float32Array([.5*
a[0]+.5*a[3],.5*a[1]+.5*a[4],.5*a[2]+.5*a[5],a[3],a[4],a[5],.5*a[3]+.5*a[6],.5*a[4]+.5*a[7],.5*a[5]+.5*a[8],.5*a[0]+.5*a[6],.5*a[1]+.5*a[7],.5*a[2]+.5*a[8]])},this.c01={parent:this,quadrant:"c01",z:b.z+1,x:2*b.x,y:2*b.y+1,f:b.f,v:new Float32Array([.5*a[0]+.5*a[9],.5*a[1]+.5*a[10],.5*a[2]+.5*a[11],.5*a[0]+.5*a[6],.5*a[1]+.5*a[7],.5*a[2]+.5*a[8],.5*a[9]+.5*a[6],.5*a[10]+.5*a[7],.5*a[11]+.5*a[8],a[9],a[10],a[11]])},this.c11={parent:this,quadrant:"c11",z:b.z+1,x:2*b.x+1,y:2*b.y+1,f:b.f,v:new Float32Array([.5*
a[0]+.5*a[6],.5*a[1]+.5*a[7],.5*a[2]+.5*a[8],.5*a[3]+.5*a[6],.5*a[4]+.5*a[7],.5*a[5]+.5*a[8],a[6],a[7],a[8],.5*a[9]+.5*a[6],.5*a[10]+.5*a[7],.5*a[11]+.5*a[8]])});this.max={x:Math.max(a[0],a[6]),y:Math.max(a[1],a[7]),z:Math.max(a[2],a[8])};this.min={x:Math.min(a[0],a[6]),y:Math.min(a[1],a[7]),z:Math.min(a[2],a[8])};this.loadedAt=V.time};M.Node.prototype.overlaps=function(a){return!0};
M.Node.prototype.clear=function(){gl.deleteTexture(this.textureId);delete this.textureId;M.memoryUsed-=this.memoryUsed;this.c00.glId&&this.c00.clear();this.c00=null;this.c10.glId&&this.c10.clear();this.c10=null;this.c01.glId&&this.c01.clear();this.c01=null;this.c11.glId&&this.c11.clear();this.c11=null};
M.Node.prototype.unload=function(a){a.clear();a==this.c00?this.c10={parent:this,quadrant:"c00",z:this.z+1,x:2*this.x,y:2*this.y}:a==this.c10?this.c10={parent:this,quadrant:"c10",z:this.z+1,x:2*this.x+1,y:2*this.y}:a==this.c01?this.c01={parent:this,quadrant:"c01",z:this.z+1,x:2*this.x,y:2*this.y+1}:a==this.c11&&(this.c11={parent:this,quadrant:"c11",z:this.z+1,x:2*this.x+1,y:2*this.y+1})};
M.Node.prototype.render=function(a,b){b.bindBuffer(this.vbo);gl.bindTexture(gl.TEXTURE_2D,this.glTextureId);gl.drawElements(gl.TRIANGLES,6,gl.UNSIGNED_SHORT,0)};M.Node.prototype.load=function(){var a=this.c00.glTextureId;null==a&&this.image.scheduleImage(this.c00);var b=this.c01.glTextureId;null==b&&this.image.scheduleImage(this.c01);var d=this.c10.glTextureId;null==d&&this.image.scheduleImage(this.c10);var e=this.c11.glTextureId;null==e&&this.image.scheduleImage(this.c11);return a&&b&&d&&e};
M.Image=class extends V.Dataset{constructor(a,b){super(a);this.maxZoom=this.root.maxZoom;this.tileWidth=this.root.tileSize;this.format=this.root.format;GL.BoundingBox.init(this);GL.BoundingBox.grow(this,{x:1,y:1,z:1});GL.BoundingBox.grow(this,{x:-1,y:-1,z:-1});this.vbo={uv:new GL.ArrayBuffer(new Float32Array([0,0,1,0,1,1,0,1]))};this.ibo=new GL.ElementBuffer(new Uint16Array([0,1,2,0,2,3]));this.loadingQ=new V.Queue;for(a=0;6>a;a++){var d=new Image;d.onload=this.imageLoaded.bind(this);d.onerror=this.imageError.bind(this);
d.crossOrigin="Anonymous";this.loadingQ.enqueue(d)}this.scheduleImage({z:0,x:0,y:0,f:"l",v:new Float32Array([-1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1]),id:0});this.scheduleImage({z:0,x:0,y:0,f:"r",v:new Float32Array([1,1,-1,1,1,1,1,-1,1,1,-1,-1]),id:0});this.scheduleImage({z:0,x:0,y:0,f:"u",v:new Float32Array([-1,1,1,1,1,1,1,1,-1,-1,1,-1]),id:0});this.scheduleImage({z:0,x:0,y:0,f:"d",v:new Float32Array([-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1]),id:0});this.scheduleImage({z:0,x:0,y:0,f:"f",v:new Float32Array([-1,1,
-1,1,1,-1,1,-1,-1,-1,-1,-1]),id:0});this.scheduleImage({z:0,x:0,y:0,f:"b",v:new Float32Array([1,1,1,-1,1,1,-1,-1,1,1,-1,1]),id:0});this.face={};this.renderQ=new V.PriorityQueue(function(e,c){return e.z-c.z});b(this.config)}scheduleImage(a){if(!this.loadingQ.empty()){var b=this.loadingQ.dequeue();b.proxy=a;b.src=this.url.replace("FILE",a.z+"/"+a.f+a.x+"_"+a.y);a.loaderIMG=b}}imageLoaded(a){a=a.srcElement;a.proxy.loaderIMG=null;var b=gl.createTexture();gl.bindTexture(gl.TEXTURE_2D,b);gl.texParameteri(gl.TEXTURE_2D,
gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR);gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,a);gl.bindTexture(gl.TEXTURE_2D,null);0<a.proxy.z?a.proxy.parent[a.proxy.quadrant]=new M.Node(this,a.proxy,b,a.proxy.parent):this.face[a.proxy.f]=new M.Node(this,a.proxy,b);URL.revokeObjectURL(a.src);this.loadingQ.enqueue(a);
V.touch3d()}imageError(a){a=a.srcElement;a.proxy.loaderIMG=null;var b=gl.createTexture();gl.bindTexture(gl.TEXTURE_2D,b);gl.texImage2D(gl.TEXTURE_2D,0,gl.RGB,1,1,0,gl.RGB,gl.UNSIGNED_BYTE,new Uint8Array([255,255,255]));gl.generateMipmap(gl.TEXTURE_2D);gl.bindTexture(gl.TEXTURE_2D,null);0<a.proxy.z?a.proxy.parent[a.proxy.quadrant]=new M.Node(this,a.proxy,b,3,a.proxy.parent):this.face[a.proxy.id]=new M.Node(this,a.proxy,b,3);URL.revokeObjectURL(a.src);this.loadingQ.enqueue(a);V.touch3d()}render(a){var b=
V.camera;a=a.shader;for(var d=0;gl.drawingBufferWidth>this.tileWidth*Math.pow(2,d)*b.projection.fovH&&d!=this.maxZoom;)d++;var e=new V.PriorityQueue(function(f,g){return f.z-g.z});for(c in this.face)this.face[c]&&b.intersectsBox(this.face[c])&&e.enqueue(this.face[c]);for(this.renderQ.clear();!e.empty();){var c=e.dequeue();c.z<d?c.z<this.maxZoom&&c.load()?(b.intersectsBox(c.c00)&&e.enqueue(c.c00),b.intersectsBox(c.c01)&&e.enqueue(c.c01),b.intersectsBox(c.c10)&&e.enqueue(c.c10),b.intersectsBox(c.c11)&&
e.enqueue(c.c11)):this.renderQ.enqueue(c):this.renderQ.enqueue(c)}a.useProgram(b);a.enableBuffer();a.bindBuffer(this.vbo);gl.activeTexture(gl.TEXTURE0);gl.uniform1i(a.samplerMap,0);for(gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,this.ibo.glId);!this.renderQ.empty();)c=this.renderQ.dequeue(),c.render(b,a,this.ibo);gl.bindTexture(gl.TEXTURE_2D,null);a.disableBuffer()}unload(){for(var a in this.face)this.face[a].clear();this.face=[]}getViewpoint(){return{}}setViewpoint(a){}raycast(a,b){b.distance=Math.min(b.distance,
1);b.hits&&b.hits.push({id:this.id,distance:1});b.xyz&&(b.xyz={x:a.origin.x,y:a.origin.y,z:1});b.normal&&(b.normal={x:-a.direction.x,y:-a.direction.y,z:-a.direction.z})}};
</script>

</html>

